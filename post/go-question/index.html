<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="theme-color" content="dark">
    <title>Go Question | Road to Final</title>

    <meta property="og:site_name" content="Road to Final" />
    <meta property="og:title" content="Go Question | Road to Final"/>
    <meta itemprop="name" content="Go Question | Road to Final" />
    <meta name="twitter:title" content="Go Question | Road to Final" />
    <meta name="application-name" content="Go Question | Road to Final" />
    <meta name="google-site-verification" content="neq0aVeCWe7m8dRcG0DYe70W84dIh8_CqQDqP-G9mlI" />
    <meta name="description" content="Goå¸¸è§é¢è¯•é¢˜" />
    <meta name="twitter:description" content="Goå¸¸è§é¢è¯•é¢˜ "/>
    <meta itemprop="description" content=" Goå¸¸è§é¢è¯•é¢˜ "/>
    <meta property="og:description" content=" Goå¸¸è§é¢è¯•é¢˜ " />

    

<meta property="og:type" content="article" />
<meta property="article:publisher" content="Hearecho" />
<meta property="og:article:published_time" content=2022-02-25T14:12:22&#43;0800 />
<meta property="article:published_time" content=2022-02-25T14:12:22&#43;0800 />





<script defer type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Go Question",
    "author": {
      "@type": "Person",
      "name": "Hearecho"
    },
    "datePublished": "2022-02-25",
    "description": "Goå¸¸è§é¢è¯•é¢˜",
    "wordCount":  2240 ,
    "mainEntityOfPage": "True",
    "dateModified": "2022-02-25",
    "publisher": {
      "@type": "Organization",
      "name": "Hearecho",
      "logo": {
        "@type": "imageObject",
        "url": "https:\/\/hearecho.github.io\/favicon.ico"
      }
    }
  }
</script>



    <link rel="shortcut icon" type="image/x-icon" href="https://hearecho.github.io/favicon.ico" />
    
    <link rel="stylesheet" href="https://hearecho.github.io/sass/main.min.40aeb6acef96d81040c330db146a4d454b7f961bd5de06d6a1957365ac9232d5.css">
	
</head>

    <body class="dark">
        <nav class="navbar">
    <div class="container">
        <div class="flex">
            <div>
                <a class="brand" href="https://hearecho.github.io/">
                    
                    <span class="emoji">
                        ğŸ˜
                    </span>
                    
                    
                    Road to Final
                    </a>
            </div>
            <div class="flex">
                
                <a href="https://hearecho.github.io/articles/">Articles</a>
                
                <button id="dark-mode-button">
                  <svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163 0 1 0 1.643 1.641a1.163 1.163 0 0 0-1.643-1.641zm-16.022 14.38a1.74 1.74 0 0 0 0 2.465a1.742 1.742 0 1 0 0-2.465zm13.968-2.147a2.904 2.904 0 0 1-4.108 0a2.902 2.902 0 0 1 0-4.107a2.902 2.902 0 0 1 4.108 0a2.902 2.902 0 0 1 0 4.107z" fill="#FFCC4D"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                  <svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M16 2s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2V2zm18 14s2 0 2 2s-2 2-2 2h-2s-2 0-2-2s2-2 2-2h2zM4 16s2 0 2 2s-2 2-2 2H2s-2 0-2-2s2-2 2-2h2zm5.121-8.707s1.414 1.414 0 2.828s-2.828 0-2.828 0L4.878 8.708s-1.414-1.414 0-2.829c1.415-1.414 2.829 0 2.829 0l1.414 1.414zm21 21s1.414 1.414 0 2.828s-2.828 0-2.828 0l-1.414-1.414s-1.414-1.414 0-2.828s2.828 0 2.828 0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zM16 32s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2v-2z"/><circle fill="#FFD983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                </button>
            </div>
            </div>
    </div>
</nav>
        <main>
            
<div class="container">
    <article>
        <header class="article-header">
            <div class="thumb">
                <div>
                    <h1>Go Question</h1>
                    <div class="post-meta">
                        <div>
                            
                            
                              
                            
                            By Hearecho | <time>February 25, 2022</time>
                            | 11 minutes |2240 Words
                        </div>
                        <div class="tags">
                            
                            <a href="https://hearecho.github.io/tags/go/">Go</a>
                            
                            <a href="https://hearecho.github.io/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</a>
                            
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </article>

    <div class="article-post">
    <h3 id="go-questions">Go Questions</h3>
<h4 id="1nilåˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡é›¶åˆ‡ç‰‡">1.nilåˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡ã€é›¶åˆ‡ç‰‡</h4>
<p>nilåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸º0ï¼Œè€Œæ‰€æœ‰åˆ›å»ºçš„ç©ºåˆ‡ç‰‡çš„å†…å­˜åœ°å€æ˜¯å­˜åœ¨çš„ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå›ºå®šå€¼ã€‚</p>
<p>é›¶åˆ‡ç‰‡å°±æ˜¯åº•å±‚æ•°ç»„å†…éƒ¨æ•°æ®å…¨æ˜¯<code>é›¶å˜é‡</code>ã€‚è¯´ç™½äº†å°±æ˜¯ä½¿ç”¨<code>make</code>åˆå§‹åŒ–ä¹‹åçš„åˆ‡ç‰‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">compareSlice</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">s1</span> <span class="p">[]</span><span class="kt">int</span>
	<span class="nx">s2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
	<span class="nx">s4</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;s1 pointer:%+v, s2 pointer:%+v, s4 pointer:%+v, \n&#34;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s1</span><span class="p">)),</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s2</span><span class="p">)),</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s4</span><span class="p">)))</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v\n&#34;</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s1</span><span class="p">))).</span><span class="nx">Data</span><span class="o">==</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s2</span><span class="p">))).</span><span class="nx">Data</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v\n&#34;</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s2</span><span class="p">))).</span><span class="nx">Data</span><span class="o">==</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s4</span><span class="p">))).</span><span class="nx">Data</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// ç»“æœ
</span><span class="c1"></span><span class="cm">/**
</span><span class="cm">s1 pointer:{Data:0 Len:0 Cap:0}, s2 pointer:{Data:824633999016 Len:0 Cap:0}, s4 pointer:{Data:824633999016 Len:0 Cap:0}, 
</span><span class="cm">false
</span><span class="cm">true
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="2å­—ç¬¦ä¸²è½¬æ¢ä¸ºbyteæ•°ç»„ä¼šå‘ç”Ÿå†…å­˜æ‹·è´å—">2.å­—ç¬¦ä¸²è½¬æ¢ä¸ºbyteæ•°ç»„ï¼Œä¼šå‘ç”Ÿå†…å­˜æ‹·è´å—ï¼Ÿ</h4>
<p>ä¸¥æ ¼æ¥è¯´ï¼Œåªè¦è¿›è¡Œäº†ç±»å‹çš„å¼ºåˆ¶è½¬æ¢éƒ½ä¼šå‘ç”Ÿå†…å­˜æ‹·è´ã€‚æ‰€ä»¥è¯´å­—ç¬¦ä¸²è½¬æ¢ä¸ºbyteæ•°ç»„ä¼šå‘ç”Ÿå†…å­˜æ‹·è´ã€‚goçš„å­—ç¬¦ä¸²ä¹Ÿä¸ºä¸å¯å˜å¯¹è±¡ï¼Œåœ¨å†…å­˜ä¸­çš„å®ç°æ–¹å¼æ˜¯ä¸€ä¸ªåªè¯»çš„å­—èŠ‚æ•°ç»„ã€‚å­—ç¬¦ä¸²è¦æƒ³ä¿®æ”¹åªèƒ½å…ˆè½¬æ¢ä¸ºå¯å†™çš„æ•°ç»„ï¼Œç„¶ååœ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚å…¶æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">StringHeader</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Data</span> <span class="kt">uintptr</span>
	<span class="nx">Len</span>  <span class="kt">int</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ç”¨ä»£ç å±•ç¤ºï¼Œå¯ä»¥ä»ç»“æœä¸Šçœ‹å‡ºï¼Œä¸è®ºæ˜¯ä»å­—ç¬¦ä¸²è½¬æ¢ä¸ºbyteæ•°ç»„è¿˜æ˜¯ä»byteæ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå‡å‘ç”Ÿå†…å­˜æ‹·è´äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">StringAndByte</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">s</span> <span class="o">:=</span> <span class="s">&#34;hello&#34;</span>
	<span class="nx">tempByte</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
	<span class="nx">s2</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">tempByte</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;s Pointer:%+v\n&#34;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">StringHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s</span><span class="p">)))</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;tempByte Pointer:%+v\n&#34;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">SliceHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">tempByte</span><span class="p">)))</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;s2 Pointer:%+v\n&#34;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">StringHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s2</span><span class="p">)))</span>
<span class="p">}</span>
<span class="c1">// ç»“æœ
</span><span class="c1"></span><span class="cm">/**
</span><span class="cm">s Pointer:{Data:12543120 Len:5}
</span><span class="cm">tempByte Pointer:{Data:824633999064 Len:5 Cap:32}
</span><span class="cm">s2 Pointer:{Data:824633999032 Len:5}
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>ä¸è¿‡ä¹Ÿæœ‰æ–¹æ³•å¯ä»¥ä¸ç”¨è¿›è¡Œå†…å­˜æ‹·è´å®ç°è½¬æ¢</strong>ï¼Œå®é™…ä¸Šï¼Œå­—ç¬¦ä¸²å’Œbyteæ•°ç»„çš„åº•å±‚ç»“æ„ä¹‹é—´åªæ˜¯å°‘äº†Capå­—æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†<code>StringHeader</code> çš„åœ°å€å¼ºè½¬æˆ <code>SliceHeader</code> å°±å¯ä»¥äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">a</span> <span class="o">:=</span><span class="s">&#34;aaa&#34;</span>
<span class="nx">ssh</span> <span class="o">:=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">StringHeader</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">))</span>
<span class="nx">b</span> <span class="o">:=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">[]</span><span class="kt">byte</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ssh</span><span class="p">))</span>  
</code></pre></td></tr></table>
</div>
</div><h4 id="3ç¿»è½¬å«æœ‰ä¸­æ–‡æ•°å­—è‹±æ–‡å­—æ¯çš„å­—ç¬¦ä¸²">3.ç¿»è½¬å«æœ‰ä¸­æ–‡ã€æ•°å­—ã€è‹±æ–‡å­—æ¯çš„å­—ç¬¦ä¸²</h4>
<p>å› ä¸ºä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—æ‰€å ç”¨çš„å­—èŠ‚æ•°æ˜¯ä¸ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¯ä»¥ä½¿ç”¨è½¬æ¢ä¸ºbyteæ•°ç»„æ¥è¿›è¡Œåè½¬åœ¨è½¬æ¢ï¼Œæˆ‘ä»¬è¿™ä¸ªæƒ…å†µéœ€è¦å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º<code>[]rune</code>ï¼Œå› ä¸ºå…¶è¡¨ç¤ºçš„èŒƒå›´æ›´å¤§ï¼Œ<code>rune==int32</code>è€Œ<code>byte==uint8</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">ReverseComplexString</span><span class="p">()</span>  <span class="p">{</span>
	<span class="nx">reverse</span> <span class="o">:=</span> <span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="p">[]</span><span class="kt">rune</span><span class="p">)</span> <span class="p">[]</span><span class="kt">rune</span> <span class="p">{</span>
		<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">j</span><span class="p">;</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="p">=</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
		<span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="p">=</span> <span class="nx">s</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
	<span class="p">}</span>
		<span class="k">return</span> <span class="nx">s</span>
	<span class="p">}</span>
	<span class="nx">src</span> <span class="o">:=</span> <span class="s">&#34;ä½ å¥½abcå•Šå“ˆå“ˆ&#34;</span>
	<span class="nx">dst</span> <span class="o">:=</span> <span class="nf">reverse</span><span class="p">([]</span><span class="nb">rune</span><span class="p">(</span><span class="nx">src</span><span class="p">))</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v\n&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">dst</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="4-æ‹·è´å¤§åˆ‡ç‰‡ä¸€å®šæ¯”å°åˆ‡ç‰‡çš„ä»£ä»·å¤§å—">4. æ‹·è´å¤§åˆ‡ç‰‡ä¸€å®šæ¯”å°åˆ‡ç‰‡çš„ä»£ä»·å¤§å—ï¼Ÿ</h4>
<p>å¹¶ä¸æ˜¯ï¼Œæ‰€æœ‰åˆ‡ç‰‡çš„å¤§å°ç›¸åŒï¼›<strong>ä¸‰ä¸ªå­—æ®µ</strong>ï¼ˆä¸€ä¸ª uintptrï¼Œä¸¤ä¸ªintï¼‰ã€‚åˆ‡ç‰‡ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ˜¯æŒ‡å‘åˆ‡ç‰‡åº•å±‚æ•°ç»„çš„æŒ‡é’ˆï¼Œè¿™æ˜¯åˆ‡ç‰‡çš„å­˜å‚¨ç©ºé—´ï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯åˆ‡ç‰‡çš„é•¿åº¦ï¼Œç¬¬ä¸‰ä¸ªå­—æ®µæ˜¯å®¹é‡ã€‚å°†ä¸€ä¸ª slice å˜é‡åˆ†é…ç»™å¦ä¸€ä¸ªå˜é‡åªä¼šå¤åˆ¶ä¸‰ä¸ªæœºå™¨å­—ã€‚æ‰€ä»¥ <strong>æ‹·è´å¤§åˆ‡ç‰‡è·Ÿå°åˆ‡ç‰‡çš„ä»£ä»·åº”è¯¥æ˜¯ä¸€æ ·çš„</strong>ã€‚</p>
<p><em>æ‹·è´å°±ç›¸å½“äºæ˜¯å˜æ¢æŒ‡é’ˆçš„æŒ‡å‘ï¼Œè€Œä¸æ˜¯å°†å†…å­˜æ•°æ®ä»ä¸€ä¸ªåœ°å€æ‹·è´åˆ°å¦ä¸€å¤„åœ°å€ï¼Œæ‰€ä»¥è¿™ä¸ªåªæ›´æ¢æŒ‡é’ˆçš„æŒ‡å‘ä¹Ÿé€ æˆäº†æ›´æ”¹å…¶ä¸­ä¸€ä¸ªåˆ‡ç‰‡çš„æ•°æ®ï¼Œå¦ä¸€ä¸ªåˆ‡ç‰‡æ˜¾ç¤ºçš„æ•°æ®ä¹Ÿä¼šæ”¹å˜å³ä¸º<strong>æµ…æ‹·è´</strong></em></p>
<h4 id="5-mapä¸åˆå§‹åŒ–ä½¿ç”¨ä¼šæ€ä¹ˆæ ·sliceå‘¢">5. mapä¸åˆå§‹åŒ–ä½¿ç”¨ä¼šæ€ä¹ˆæ ·ï¼Œsliceå‘¢ï¼Ÿ</h4>
<p>mapä¸åˆå§‹åŒ–ä¸ºnilï¼Œå‘é‡Œé¢æ·»åŠ å€¼ä¼šç›´æ¥æŠ¥é”™ã€‚<code>panic: assignment to entry in nil map</code>ã€‚ä½†æ˜¯å¯ä»¥è¿›è¡Œå–å€¼ï¼Œä¸è¿‡è¿”å›çš„æ˜¯å¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚å¹¶ä¸”åˆå§‹åŒ–å’Œä¸åˆå§‹åŒ–çš„mapã€‚é•¿åº¦å‡ä¸º0ã€‚ä½†æ˜¯<code>slice</code>æ˜¯å¯ä»¥å£°æ˜ä¹‹åå°±å¯ä»¥ä½¿ç”¨ï¼ˆ<strong>ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ä½¿ç”¨</strong>ï¼‰çš„ï¼Œå¯ä»¥ä½¿ç”¨<code>append</code>å‘é‡Œé¢æ·»åŠ å…ƒç´ (è¿™ç§æ–¹å¼å…¶å®æ˜¯è¿”å›äº†ä¸€ä¸ªæ–°çš„åˆ‡ç‰‡)ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨ç›´æ¥ç”¨ç´¢å¼•èµ‹å€¼çš„æ–¹æ³•æ·»åŠ å…ƒç´ ï¼Œä¸è¿‡<code>slice</code>å£°æ˜ä¸åˆå§‹åŒ–çš„è¯å…¶æŒ‡å‘çš„åº•å±‚æ•°ç»„åœ°å€ä¸º<code>0</code>ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ ä¹‹åä¼šç»™å‡ºä¸€ä¸ªå†…å­˜åœ°å€ã€‚</p>
<h4 id="6-mapæ‰¿è½½å¤šå¤§å¤§äº†ä¹‹åæ€ä¹ˆæ‰©å®¹">6. mapæ‰¿è½½å¤šå¤§ï¼Œå¤§äº†ä¹‹åæ€ä¹ˆæ‰©å®¹ï¼Ÿ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Maximum number of key/elem pairs a bucket can hold.
</span><span class="c1"></span><span class="nx">bucketCntBits</span> <span class="p">=</span> <span class="mi">3</span>
<span class="nx">bucketCnt</span>     <span class="p">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="nx">bucketCntBits</span>
<span class="c1">// æ¯ä¸ªæ¡¶å¤§å°ä¸º 8
</span><span class="c1">// Maximum average load of a bucket that triggers growth is 6.5.
</span><span class="c1">// Represent as loadFactorNum/loadFactorDen, to allow integer math.
</span><span class="c1"></span><span class="nx">loadFactorNum</span> <span class="p">=</span> <span class="mi">13</span>
<span class="nx">loadFactorDen</span> <span class="p">=</span> <span class="mi">2</span>
<span class="c1">// æº¢å‡ºå› å­å¤§å°ä¸º 6.5
</span></code></pre></td></tr></table>
</div>
</div><p>å“ˆå¸Œè¡¨ <code>runtime.hmap</code> çš„æ¡¶æ˜¯ <code>runtime.bmap</code>ã€‚æ¯ä¸€ä¸ª <code>runtime.bmap</code> éƒ½èƒ½å­˜å‚¨<strong>8</strong>ä¸ªé”®å€¼å¯¹ï¼Œå½“å“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„æ•°æ®è¿‡å¤šï¼Œå•ä¸ªæ¡¶å·²ç»è£…æ»¡æ—¶å°±ä¼šä½¿ç”¨ <code>extra.nextOverflow</code> ä¸­æ¡¶å­˜å‚¨æº¢å‡ºçš„æ•°æ®ã€‚ è€Œå‘ç”Ÿæ‰©å®¹çš„æ¡ä»¶æ˜¯ï¼š</p>
<ol>
<li>è§¦å‘ <code>load factor</code> çš„æœ€å¤§å€¼ï¼Œè´Ÿè½½å› å­å·²è¾¾åˆ°å½“å‰ç•Œé™ã€‚è´Ÿè½½å› å­è¶Šå¤§ï¼Œè¯æ˜ç©ºé—´æ•ˆç‡è¶Šé«˜ï¼ŒåŒæ—¶å‘ç”Ÿå†²çªçš„æ¦‚ç‡ä¹Ÿè¶Šå¤§ã€‚</li>
<li>æº¢å‡ºæ¡¶ <code>overflow buckets</code> è¿‡å¤šã€‚å³æº¢å‡ºæ¡¶å’Œå…¨éƒ¨æ­£å¸¸æ¡¶æ•°é‡çš„æ¯”å€¼ã€‚æ¯”å€¼è¿‡å¤§å°±è¯æ˜æº¢å‡ºæ¡¶è¿‡å¤šã€‚</li>
</ol>
<p>è€Œmapçš„æ‰©å®¹ä¹Ÿæ˜¯åˆ†ä¸ºä¸¤ç§æƒ…å†µè¿›è¡Œæ‰©å®¹çš„ï¼Œå¦‚æœæ˜¯è´Ÿè½½å› å­è¾¾åˆ°æœ€å¤§å€¼ï¼Œåˆ™æ˜¯ç›´æ¥åŠ¨æ€æ‰©å®¹å½“å‰å¤§å°ä¸¤å€ä½œä¸ºæ–°å®¹é‡çš„å¤§å°ã€‚è€Œå¦‚æœæ˜¯æº¢å‡ºæ¡¶è¿‡å¤šï¼Œåˆ™æ˜¯ä¸æ”¹å˜å¤§å°çš„æ‰©å®¹ã€‚è€Œæ‰©å®¹å¹¶ä¸æ˜¯ä¸€æ­¥åˆ°ä½ï¼Œè€Œæ˜¯å…ˆç”³è¯·æ‰©å®¹ç©ºé—´ï¼Œä½†æ˜¯ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œæ˜¯ç­‰åˆ°æœ‰æ–°çš„è®¿é—®è½åˆ°æŸä¸ªæ¡¶ä¸­ï¼Œæ‰ä¼šå¯¹è¿™ä¸ªæ¡¶è¿›è¡Œæ‰©å®¹ï¼Œä¹Ÿå°±æ˜¯å°†<code>oldbucket</code>è¿ç§»åˆ°<code>bucket</code>ã€‚</p>
<h4 id="7-mapçš„iteratoræ˜¯å¦å®‰å…¨èƒ½ä¸èƒ½ä¸€è¾¹deleteä¸€è¾¹éå†">7. mapçš„iteratoræ˜¯å¦å®‰å…¨ï¼Ÿèƒ½ä¸èƒ½ä¸€è¾¹deleteä¸€è¾¹éå†ï¼Ÿ</h4>
<p>mapçš„iteratoræ˜¯ä¸å®‰å…¨çš„ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å¯¹å…¶è¿›è¡Œå¹¶å‘çº¦æŸæ¥ä½¿å…¶åˆ°è¾¾åœ¨å¹¶å‘ä¸­çš„æ•°æ®å®‰å…¨ã€‚ä¸€èˆ¬æ˜¯ä½¿ç”¨<code>sync.RWMutex</code>æˆ–è€…æ˜¯ä½¿ç”¨<code>channel chan</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">myMap</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span>

<span class="kd">func</span> <span class="nf">myGoRoutine</span><span class="p">(</span><span class="nx">id</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">numKeys</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">wg</span> <span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>

	<span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">myMap</span> <span class="p">{</span>
		<span class="nx">myMap</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">Itoa</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">myMap</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Goroutine #%d -&gt; Key: %d, Value: %s\n&#34;</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
	<span class="p">}</span>

<span class="p">}</span>
<span class="kd">func</span> <span class="nf">UnSafeMap</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// Initially set some values
</span><span class="c1"></span>	<span class="nx">myMap</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
	<span class="nx">myMap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;test&#34;</span>
	<span class="nx">myMap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;sample&#34;</span>
	<span class="nx">myMap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="s">&#34;GoLang is Fun!&#34;</span>

	<span class="c1">// Get the number of keys
</span><span class="c1"></span>	<span class="nx">numKeys</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">myMap</span><span class="p">)</span>

	<span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">go</span> <span class="nf">myGoRoutine</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">numKeys</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">wg</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="c1">// Blocking wait
</span><span class="c1"></span>	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>

	<span class="c1">// Iterate over all keys
</span><span class="c1"></span>	<span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">myMap</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Key: %d, Value: %s\n&#34;</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="cm">/*
</span><span class="cm">ç»“æœ
</span><span class="cm">Goroutine #2 -&gt; Key: 0, Value: 2
</span><span class="cm">Goroutine #2 -&gt; Key: 2, Value: 2
</span><span class="cm">Goroutine #2 -&gt; Key: 1, Value: 2
</span><span class="cm">Goroutine #1 -&gt; Key: 0, Value: 1
</span><span class="cm">Goroutine #1 -&gt; Key: 2, Value: 1
</span><span class="cm">Goroutine #1 -&gt; Key: 1, Value: 1
</span><span class="cm">Goroutine #0 -&gt; Key: 0, Value: 0
</span><span class="cm">Goroutine #0 -&gt; Key: 2, Value: 1
</span><span class="cm">Goroutine #0 -&gt; Key: 1, Value: 1
</span><span class="cm">Key: 0, Value: 1
</span><span class="cm">Key: 2, Value: 1
</span><span class="cm">Key: 1, Value: 1
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div><p>åŒæ—¶goä¸­çš„mapæ˜¯å¯ä»¥ä¸€è¾¹è¿›è¡Œæ“ä½œç„¶åä¸€è¾¹è¿›è¡Œéå†çš„ã€‚ä½†æ˜¯è™½ç„¶ä¸ä¼šå‡ºé”™ï¼Œä½†æ˜¯å½“å‰éå†ä¸ä¼šå—åˆ°å½±å“ã€‚ä¸åƒjavaä»–ä»¬çš„è¿­ä»£å™¨å…·æœ‰Fail-Fastæ€§è´¨ã€‚</p>
<h4 id="8-æ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦æœ‰åº">8. æ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦æœ‰åº</h4>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å®ç°<code>sort.Interface</code>çš„æ¥å£ç±»å‹ï¼Œç„¶åç›´æ¥è°ƒç”¨<code>sort.IsSorted()</code>æ–¹æ³•å³å¯ã€‚æˆ–è€…ç›´æ¥ä½¿ç”¨<code>sort.SliceIsSorted</code>å‡½æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">jungeSorted</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">arr</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">sort</span><span class="p">.</span><span class="nf">SliceIsSorted</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">&gt;</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
	<span class="p">}))</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="9-arrayå’Œsliceçš„åŒºåˆ«">9. arrayå’Œsliceçš„åŒºåˆ«</h4>
<p>æ•°ç»„<code>array</code>æ˜¯å€¼ç±»å‹çš„ï¼Œå…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œå°±æ˜¯å°†æ•°ç»„æ‹·è´ä¸€ä»½ï¼Œè€Œåˆ‡ç‰‡<code>slice</code>æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€æŒ‡å‘æ•°ç»„åˆ‡ç‰‡çš„æŒ‡é’ˆï¼Œä¸å®šé•¿ã€‚å£°æ˜æ•°ç»„çš„æ—¶å€™ï¼Œæ–¹æ‹¬å·å†…å†™æ˜äº†æ•°ç»„é•¿åº¦æˆ–è€…ä½¿ç”¨<code>...</code>è¿›è¡Œä»£æ›¿ï¼Œè€Œå£°ååˆ‡ç‰‡çš„æ—¶å€™æ–¹æ‹¬å·å†…éƒ¨ä¸ºç©ºã€‚ä½œä¸ºå‡½æ•°å‚æ•°æ—¶å€™ï¼Œåˆ‡ç‰‡ä¼ é€’çš„æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨å‡½æ•°å†…éƒ¨æ”¹åŠ¨ï¼Œå¤–éƒ¨åˆ‡ç‰‡ä¹Ÿä¼šå‘ç”Ÿç›¸åº”çš„å˜åŒ–ã€‚</p>
<h4 id="10-jsonåŒ…å˜é‡ä¸åŠ tagä¼šæ€ä¹ˆæ ·">10. jsonåŒ…å˜é‡ä¸åŠ tagä¼šæ€ä¹ˆæ ·ï¼Ÿ</h4>
<ul>
<li>
<p>å¦‚æœå˜é‡<code>é¦–å­—æ¯å°å†™</code>ï¼Œåˆ™ä¸º<code>private</code>ã€‚æ— è®ºå¦‚ä½•<code>ä¸èƒ½è½¬</code>ï¼Œå› ä¸ºå–ä¸åˆ°<code>åå°„ä¿¡æ¯</code>ã€‚</p>
</li>
<li>
<p>å¦‚æœå˜é‡<code>é¦–å­—æ¯å¤§å†™</code>ï¼Œåˆ™ä¸º<code>public</code>ã€‚</p>
</li>
<li>
<ul>
<li><code>ä¸åŠ tag</code>ï¼Œå¯ä»¥æ­£å¸¸è½¬ä¸º<code>json</code>é‡Œçš„å­—æ®µï¼Œ<code>json</code>å†…å­—æ®µåè·Ÿç»“æ„ä½“å†…å­—æ®µ<code>åŸåä¸€è‡´</code>ã€‚</li>
<li><code>åŠ äº†tag</code>ï¼Œä»<code>struct</code>è½¬<code>json</code>çš„æ—¶å€™ï¼Œ<code>json</code>çš„å­—æ®µåå°±æ˜¯<code>tag</code>é‡Œçš„å­—æ®µåï¼ŒåŸå­—æ®µåå·²ç»æ²¡ç”¨ã€‚</li>
</ul>
</li>
</ul>
<p><code>tag</code>ä¿¡æ¯æ˜¯å¯ä»¥é€šè¿‡<code>reflect</code>è·å–çš„ã€‚å³ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">J</span> <span class="kd">struct</span> <span class="p">{</span>    <span class="nx">a</span> <span class="kt">string</span> <span class="c1">//å°å†™æ— tag    b string `json:&#34;B&#34;` //å°å†™+tag    C string //å¤§å†™æ— tag    D string `json:&#34;DD&#34; otherTag:&#34;good&#34;` //å¤§å†™+tag}func printTag(stru interface{}) {    t := reflect.TypeOf(stru).Elem()    for i := 0; i &lt; t.NumField(); i++ {        fmt.Printf(&#34;ç»“æ„ä½“å†…ç¬¬%vä¸ªå­—æ®µ %v å¯¹åº”çš„json tagæ˜¯ %v , è¿˜æœ‰otherTagï¼Ÿ = %v \n&#34;, i+1, t.Field(i).Name, t.Field(i).Tag.Get(&#34;json&#34;), t.Field(i).Tag.Get(&#34;otherTag&#34;)) }}func main() {    j := J{      a: &#34;1&#34;,      b: &#34;2&#34;,      C: &#34;3&#34;,      D: &#34;4&#34;,    }    printTag(&amp;j)}
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>printTag</code>æ–¹æ³•ä¼ å…¥çš„æ˜¯<code>j</code>çš„æŒ‡é’ˆã€‚</li>
<li><code>reflect.TypeOf(stru).Elem()</code>è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼å¯¹åº”çš„ç»“æ„ä½“å†…å®¹ã€‚</li>
<li><code>NumField()</code>å¯ä»¥è·å¾—è¯¥ç»“æ„ä½“çš„å«æœ‰å‡ ä¸ªå­—æ®µã€‚</li>
<li>éå†ç»“æ„ä½“å†…çš„å­—æ®µï¼Œé€šè¿‡<code>t.Field(i).Tag.Get(&quot;json&quot;)</code>å¯ä»¥è·å–åˆ°<code>tag</code>ä¸º<code>json</code>çš„å­—æ®µã€‚</li>
<li>å¦‚æœç»“æ„ä½“çš„å­—æ®µæœ‰<code>å¤šä¸ªtag</code>ï¼Œæ¯”å¦‚å«<code>otherTag</code>,åŒæ ·å¯ä»¥é€šè¿‡<code>t.Field(i).Tag.Get(&quot;otherTag&quot;)</code>è·å¾—</li>
</ul>
<h4 id="11-æ·±æ‹·è´å’Œæµ…æ‹·è´">11. æ·±æ‹·è´å’Œæµ…æ‹·è´</h4>
<p>â€‹	ä¸€èˆ¬ç®€å•çš„æ‹·è´ï¼Œå³æŒ‡é’ˆæŒ‡å‘è½¬æ¢ï¼Œå³è™½ç„¶æ˜¯ä¸¤ä¸ªåˆ‡ç‰‡ï¼Œä½†æ˜¯ä»–ä»¬æŒ‡å‘åŒä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œæ­¤ä¸ºæµ…æ‹·è´ï¼Œå³é€šè¿‡å…¶ä¸­ä¸€ä¸ªåˆ‡ç‰‡ä¿®æ”¹æ•°æ®ï¼Œå¦ä¸€ä¸ªåˆ‡ç‰‡çš„å†…å®¹ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚è€Œæ·±æ‹·è´ï¼Œåˆ™æ˜¯è¿›è¡Œäº†å†…å­˜æ‹·è´ï¼Œåº•å±‚æ•°ç»„çš„æ‹·è´ï¼Œä¸¤ä¸ªåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€æ˜¯ä¸ç›¸åŒçš„ã€‚åŒæ—¶éœ€è¦æ³¨æ„å¼•ç”¨åˆ‡ç‰‡ï¼Œå…¶ä¸­çš„å¼•ç”¨å¦‚æœä¸è¿›è¡Œé€’å½’æ·±æ‹·è´ï¼Œåˆ™è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜ã€‚</p>
<h4 id="12-makeå’Œnewçš„åŒºåˆ«">12. makeå’Œnewçš„åŒºåˆ«</h4>
<p>â€‹	newå¯ä»¥ç”¨äºä»»ä½•ç±»å‹çš„åˆ†é…ç©ºé—´ï¼ŒæŒ‡å®šå†…å­˜ï¼Œå¹¶è¿”å›è¯¥ç±»å‹çš„æŒ‡é’ˆã€‚åŒæ—¶ new å‡½æ•°ä¼šæŠŠåˆ†é…çš„å†…å­˜ç½®ä¸ºé›¶ï¼Œä¹Ÿå°±æ˜¯ç±»å‹çš„é›¶å€¼ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// The new built-in function allocates memory. The first argument is a type,// not a value, and the value returned is a pointer to a newly// allocated zero value of that type.func new(Type) *Type
</span></code></pre></td></tr></table>
</div>
</div><p><code>make</code>åªèƒ½ç”¨äº<code>slice, map, channel</code>çš„åˆå§‹åŒ–ã€‚è¿™ä¸‰ä¸ªåˆšå¥½ä¸ºå¼•ç”¨ç±»å‹ï¼Œå¹¶ä¸”<strong>Unlike new, make&rsquo;s return type is the same as the type of its
argument, not a pointer to it.</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// The make built-in function allocates and initializes an object of type// slice, map, or chan (only). Like new, the first argument is a type, not a// value. Unlike new, make&#39;s return type is the same as the type of its// argument, not a pointer to it. The specification of the result depends on// the type://	Slice: The size specifies the length. The capacity of the slice is//	equal to its length. A second integer argument may be provided to//	specify a different capacity; it must be no smaller than the//	length. For example, make([]int, 0, 10) allocates an underlying array//	of size 10 and returns a slice of length 0 and capacity 10 that is//	backed by this underlying array.//	Map: An empty map is allocated with enough space to hold the//	specified number of elements. The size may be omitted, in which case//	a small starting size is allocated.//	Channel: The channel&#39;s buffer is initialized with the specified//	buffer capacity. If zero, or the size is omitted, the channel is//	unbuffered.func make(t Type, size ...IntegerType) Type
</span></code></pre></td></tr></table>
</div>
</div><h4 id="13--slicemapchannelåˆ›å»ºçš„æ—¶å€™çš„å‡ ä¸ªå‚æ•°ä»€ä¹ˆå«ä¹‰">13.  slice,map,channelåˆ›å»ºçš„æ—¶å€™çš„å‡ ä¸ªå‚æ•°ä»€ä¹ˆå«ä¹‰ï¼Ÿ</h4>
<p>â€‹	ç”±äºåˆ‡ç‰‡çš„åº•å±‚å³<code>SliceHeader</code>çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚è€Œåˆ›å»ºåˆ‡ç‰‡çš„ä½¿ç”¨<code>make(type, len, cap)</code>ï¼Œ<code>cap</code>é€šå¸¸å¯ä»¥çœç•¥ï¼Œçœç•¥æƒ…å†µä¸‹<code>cap=len</code>ã€‚å› ä¸ºä¸¤è€…ä¹‹é—´çš„å…³ç³»ä¸º<code>cap&gt;=len&gt;=0</code>ã€‚å…¶ä¸­<code>cap</code>ä»£è¡¨å®¹é‡ï¼Œ<code>len</code>ä»£è¡¨å½“å‰åˆ‡ç‰‡çš„é•¿åº¦ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SliceHeader</span> <span class="kd">struct</span> <span class="p">{</span>	<span class="nx">Data</span> <span class="kt">uintptr</span>	<span class="nx">Len</span>  <span class="kt">int</span>	<span class="nx">Cap</span>  <span class="kt">int</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è€Œæˆ‘ä»¬åˆ›å»º<code>map</code>é€šå¸¸ä½¿ç”¨<code>make(map[Type]Type,size)</code>ï¼Œ<code>size</code>è¡¨ç¤ºmapçš„å­˜å‚¨èƒ½åŠ›ï¼Œå¯ä»¥çœç•¥ã€‚ä½¿ç”¨<code>make(chan Type, size)</code>åˆ›å»ºchannelè€Œ<code>size</code>è¡¨ç¤ºçš„å…·æœ‰é€šé“çš„ç¼“å†²åŒºå¤§å°ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™è¡¨ç¤ºè¯¥é€šé“ä¸å…·æœ‰ç¼“å†²åŒºï¼Œé»˜è®¤<code>size=0</code>ã€‚</p>
<h4 id="14-sliceæ‰©å®¹">14 sliceæ‰©å®¹</h4>
<p>æºä»£ç å¦‚ä¸‹ï¼šå¯ä»¥çœ‹å‡ºå½“å½“å‰çš„å®¹é‡å°äºæ‰©å®¹ä¹‹åçš„å®¹é‡çš„é•¿åº¦çš„æ—¶å€™ï¼Œå¹¶ä¸”å½“å‰çš„é•¿åº¦å°äº1024ï¼Œåˆ™æ‰©å®¹ä¸ºå½“å‰çš„ä¸¤å€ï¼Œå¦åˆ™æ‰©å®¹å››åˆ†ä¹‹ä¸€å¤§å°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">grow</span><span class="p">(</span><span class="nx">s</span> <span class="nx">Value</span><span class="p">,</span> <span class="nx">extra</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="nx">Value</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>	<span class="nx">i0</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">Len</span><span class="p">()</span>	<span class="nx">i1</span> <span class="o">:=</span> <span class="nx">i0</span> <span class="o">+</span> <span class="nx">extra</span>	<span class="k">if</span> <span class="nx">i1</span> <span class="p">&lt;</span> <span class="nx">i0</span> <span class="p">{</span>		<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;reflect.Append: slice overflow&#34;</span><span class="p">)</span>	<span class="p">}</span>	<span class="nx">m</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">Cap</span><span class="p">()</span>	<span class="k">if</span> <span class="nx">i1</span> <span class="o">&lt;=</span> <span class="nx">m</span> <span class="p">{</span>		<span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nf">Slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">i1</span><span class="p">),</span> <span class="nx">i0</span><span class="p">,</span> <span class="nx">i1</span>	<span class="p">}</span>	<span class="k">if</span> <span class="nx">m</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>		<span class="nx">m</span> <span class="p">=</span> <span class="nx">extra</span>	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>		<span class="k">for</span> <span class="nx">m</span> <span class="p">&lt;</span> <span class="nx">i1</span> <span class="p">{</span>			<span class="k">if</span> <span class="nx">i0</span> <span class="p">&lt;</span> <span class="mi">1024</span> <span class="p">{</span>				<span class="nx">m</span> <span class="o">+=</span> <span class="nx">m</span>			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>				<span class="nx">m</span> <span class="o">+=</span> <span class="nx">m</span> <span class="o">/</span> <span class="mi">4</span>			<span class="p">}</span>		<span class="p">}</span>	<span class="p">}</span>	<span class="nx">t</span> <span class="o">:=</span> <span class="nf">MakeSlice</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nf">Type</span><span class="p">(),</span> <span class="nx">i1</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span>	<span class="nf">Copy</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>	<span class="k">return</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">i0</span><span class="p">,</span> <span class="nx">i1</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="15-çº¿ç¨‹å®‰å…¨çš„mapæ€ä¹ˆå®ç°">15. çº¿ç¨‹å®‰å…¨çš„mapæ€ä¹ˆå®ç°</h4>
<p>goé‡Œé¢çš„mapå¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œå®ç°å…¶å®‰å…¨ä¸»è¦æœ‰ä¸‰ç§æ–¹æ³•ï¼›</p>
<ul>
<li>
<p>é‡‡ç”¨<code>sync.RWMutex</code>æˆ–è€…æ˜¯åœ¨åç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨<code>chan</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">RWMap</span> <span class="kd">struct</span> <span class="p">{</span> <span class="c1">// ä¸€ä¸ªè¯»å†™é”ä¿æŠ¤çš„çº¿ç¨‹å®‰å…¨çš„map    sync.RWMutex 	// è¯»å†™é”ä¿æŠ¤ä¸‹é¢çš„mapå­—æ®µ    m map[int]int}
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ç®€å•çš„é‡‡ç”¨<code>sync.RWMutex</code>ï¼Œè™½ç„¶åŠŸèƒ½ä¸Šèƒ½å¤Ÿæ»¡è¶³ï¼Œä½†æ˜¯åœ¨æ€§èƒ½ä¸Šï¼Œç”±äºæ˜¯å¯¹æ•´ä¸ªå“ˆå¸Œè¡¨è¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚æˆ‘ä»¬å¯ä»¥å­¦ä¹ <code>java</code>å¯¹å“ˆå¸Œè¡¨åŠ é”çš„å¤„ç†æ–¹å¼ï¼Œä½¿ç”¨å¤šæ®µé”ï¼Œé™ä½é”çš„ç²’åº¦ï¼Œgoä¸­æ¯”è¾ƒçŸ¥åçš„åˆ†ç‰‡mapå®ç°æ˜¯<code>orcaman/concurrent-map</code>,å…¶å¯¹å°†æ•´ä¸ªmapåˆ†ä¸ºnå¿«ï¼Œæ¯ä¸ªå—è¯»å†™æ“ä½œäº’ç›¸ä¸å¹²æ‰°ã€‚å®ç°åŸç†ä¹Ÿç±»ä¼¼ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªåˆ‡ç‰‡ä¸­å­˜å‚¨å¸¦æœ‰è¯»å†™é”çš„mapï¼Œç„¶åé€šè¿‡è®¡ç®—keyåœ¨å“ªä¸€ä¸ªåˆ†ç‰‡ä¸Šæ¥è¿›è¡Œå“ˆå¸Œè¡¨çš„è¯»å†™ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">SHARD_COUNT</span> <span class="p">=</span> <span class="mi">32</span><span class="c1">// åˆ†æˆSHARD_COUNTä¸ªåˆ†ç‰‡çš„maptype ConcurrentMap []*ConcurrentMapShared// é€šè¿‡RWMutexä¿æŠ¤çš„çº¿ç¨‹å®‰å…¨çš„åˆ†ç‰‡ï¼ŒåŒ…å«ä¸€ä¸ªmaptype ConcurrentMapShared struct {    items        map[string]interface{}    sync.RWMutex // Read Write mutex, guards access to internal map.}// åˆ›å»ºå¹¶å‘mapfunc New() ConcurrentMap {    m := make(ConcurrentMap, SHARD_COUNT)    for i := 0; i &lt; SHARD_COUNT; i++ {        m[i] = &amp;ConcurrentMapShared{items: make(map[string]interface{})}    }    return m}// æ ¹æ®keyè®¡ç®—åˆ†ç‰‡ç´¢å¼•func (m ConcurrentMap) GetShard(key string) *ConcurrentMapShared {    return m[uint(fnv32(key))%uint(SHARD_COUNT)]}
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å†…ç½®çš„<code>sync,map</code>æ˜¯ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„mapï¼Œä½†æ˜¯ç”¨çš„æ¯”è¾ƒå°‘ï¼Œä¸»è¦æ˜¯ç”¨äºä¸€å†™å¤šè¯»æˆ–è€…æ˜¯å„ä¸ªåç¨‹æ“ä½œçš„keyé›†åˆæ²¡æœ‰äº¤é›†æˆ–è€…æ˜¯äº¤é›†å¾ˆå°‘ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡æ€§èƒ½ã€‚</p>
</li>
</ul>
<h4 id="16-structæ˜¯å¦å¯ä»¥è¿›è¡Œæ¯”è¾ƒ">16. structæ˜¯å¦å¯ä»¥è¿›è¡Œæ¯”è¾ƒ?</h4>
<p>åœ¨goä¸­æ•°æ®ç±»å‹å¯ä»¥æ¯”è¾ƒä¸ä¸å¯ä»¥æ¯”è¾ƒçš„æ•°æ®ç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>å¯æ¯”è¾ƒï¼š<em>Integer</em>ï¼Œ<em>Floating-point</em>ï¼Œ<em>String</em>ï¼Œ<em>Boolean</em>ï¼Œ<em>Complex(å¤æ•°å‹)</em>ï¼Œ<em>Pointer</em>ï¼Œ<em>Channel</em>ï¼Œ<em>Interface</em>ï¼Œ<em>Array</em></li>
<li>ä¸å¯æ¯”è¾ƒï¼š<em>Slice</em>ï¼Œ<em>Map</em>ï¼Œ<em>Function</em></li>
</ul>
<p><code>struct</code>æ˜¯å¦å¯ä»¥æ¯”è¾ƒä»¥åŠæ¯”è¾ƒä¹‹åçš„ç»“æœï¼Œä¸»è¦æ˜¯çœ‹å…¶å†…éƒ¨å­—æ®µçš„ç±»å‹ï¼Œå¦‚æœå…¶å†…éƒ¨å­—æ®µç±»å‹å‡ä¸ºå¯ä»¥æ¯”è¾ƒçš„æ•°æ®ç±»å‹ï¼Œåˆ™è¯¥<code>struct</code>æ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼Œå¦‚æœå«æœ‰ä¸å¯æ¯”è¾ƒçš„æ•°æ®ç±»å‹ï¼Œåˆ™<code>struct</code>ä¹Ÿä¸å¯æ¯”è¾ƒã€‚å¹¶ä¸”ç»“æ„ä½“æ˜¯å¦ç›¸ç­‰ï¼Œä¹Ÿè¦çœ‹å…¶å†…éƒ¨çš„æ•°æ®å€¼ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>reflect.DeepEqual</code>æ¥å®ç°åŒ…å«ä¸å¯ç›´æ¥æ¯”è¾ƒçš„æ•°æ®ç±»å‹çš„ç»“æ„ä½“å®ä¾‹çš„æ¯”è¾ƒã€‚<code>reflect.DeepEqual</code>å°±æ˜¯æ¯”è¾ƒæ‰€æœ‰çš„å€¼ï¼Œå³ä¸¤ä¸ªå€¼æ·±åº¦ä¸€è‡´ã€‚</p>
<h4 id="17-mapå¦‚ä½•å®ç°é¡ºåºè¯»å–">17. mapå¦‚ä½•å®ç°é¡ºåºè¯»å–</h4>
<p>â€‹	<code>map</code>ä¸€èˆ¬çš„è¯»å†™çš„é¡ºåºæ˜¯ä¸å›ºå®šï¼Œæƒ³è¦å®ç°é¡ºåºè¯»å†™ï¼Œéœ€è¦å…ˆå°†<code>key</code>å–å‡ºï¼Œç„¶åå†é€šè¿‡<code>key</code>å–å‡º<code>value</code>ã€‚è€Œä¸€èˆ¬å¯¹<code>map</code>è¿›è¡Œæ’åºè¾“å‡ºï¼Œä¹Ÿæ˜¯é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸è¿‡æ˜¯éœ€è¦å¯¹<code>key</code>è¿›è¡Œæ’åºã€‚</p>
<h4 id="18--goä¸­å®ç°set">18.  goä¸­å®ç°set</h4>
<p>â€‹	æ•ˆä»¿<code>java</code>ä¸­<code>hashset</code>çš„å®ç°ï¼Œç”±äº<code>map</code>ä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒçš„<code>key</code>å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>map</code>å®ç°ã€‚å½“ç„¶ç”±äº<code>map</code>ä¸­çš„<code>key</code>å¿…é¡»æ˜¯è¦ç”±å¯ä»¥æ¯”è¾ƒçš„æ•°æ®ç±»å‹æ„æˆï¼Œæ‰€ä»¥ä¾‹å¦‚åˆ‡ç‰‡ã€å“ˆå¸Œè¡¨ã€å‡½æ•°æ˜¯ä¸å¯ä»¥çš„ã€‚è€Œç»“æ„ä½“å†…éƒ¨ä¹Ÿå¿…é¡»ä¸å«æœ‰ä¸å¯æ¯”è¾ƒç±»å‹ã€‚æ•°æ®ç±»å‹å¦‚ä¸‹ï¼Œä½¿ç”¨<code>struct{}</code>ä½œä¸º<code>value</code>çš„åŸå› æ˜¯å› ä¸ºå…¶å ç”¨çš„å†…å­˜å¤§å°ä¸º0ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Set</span> <span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="kd">struct</span><span class="p">{}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="19--golangä¸­æ˜¯å¦å¯ä»¥è¿›è¡ŒæŒ‡é’ˆè¿ç®—">19.  golangä¸­æ˜¯å¦å¯ä»¥è¿›è¡ŒæŒ‡é’ˆè¿ç®—ï¼Ÿ</h4>
<p>â€‹	golangä¸­æœ‰æ™®é€šæŒ‡é’ˆï¼Œ<code>unsafe.Poniter</code>ï¼Œä»¥åŠ<code>uintptr</code>ã€‚å…¶ä¸­åªæœ‰<code>uintptr</code>å¯ä»¥è¿›è¡ŒæŒ‡é’ˆè¿ç®—ï¼Œä½†æ˜¯goçš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸ä¼šå°†<code>uintptr</code>çœ‹ä½œæŒ‡é’ˆï¼Œ<code>uintptr</code>æ— æ³•æŒæœ‰å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šè¢«å›æ”¶ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°†æ™®é€šæŒ‡é’ˆé€šè¿‡<code>unsafe.Poniter</code>è½¬æ¢ä¸º<code>uintptr</code>ï¼Œè¿›è¡Œè¿ç®—æ“ä½œä¹‹åï¼Œåœ¨è½¬æ¢ä¸ºæ™®é€šæŒ‡é’ˆã€‚æ‰€ä»¥golangä¸¥æ ¼æ„ä¹‰ä¸Šä¸èƒ½è¿›è¡ŒæŒ‡é’ˆè¿ç®—ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è½¬æ¢é—´æ¥å®ŒæˆæŒ‡é’ˆè¿ç®—ã€‚</p>
<h4 id="20--for-selectæ—¶å€™å¦‚æœé€šé“å·²ç»å…³é—­ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå¦‚æœselectä¸­åªæœ‰ä¸€ä¸ªcaseå‘¢">20.  for selectæ—¶å€™ï¼Œå¦‚æœé€šé“å·²ç»å…³é—­ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œå¦‚æœselectä¸­åªæœ‰ä¸€ä¸ªcaseå‘¢ï¼Ÿ</h4>
<p>æˆ‘ä»¬å°†å…¶åˆ†ä¸ºå‡ ç§æƒ…å†µè¿›è¡Œè®¨è®ºï¼š</p>
<ol>
<li>
<p>ç¬¬ä¸€ç§æƒ…å†µå°±æ˜¯forå¾ªç¯é‡Œé¢è¢«å…³é—­çš„é€šé“ã€‚ä»ç»“æœä¸Šå¯ä»¥çœ‹å‡ºï¼Œé€šé“å…³é—­ä¹‹åï¼Œè¿˜æ˜¯ä¼šè¿›å…¥è¯»å–é€šé“ä¿¡æ¯çš„caseã€‚è¿™æ˜¯å› ä¸ºé€šé“å…³é—­ä¹‹åï¼Œåªæ˜¯ä¸èƒ½å†å‘é‡Œé¢å†™å…¥æ•°æ®ï¼Œä½†æ˜¯å¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç¡®è®¤é€šé“å·²ç»å…³é—­ï¼Œå¹¶ä¸”å·²ç»æ²¡æœ‰æ•°æ®è¯»å‡ºçš„æ—¶å€™ï¼Œå°†é€šé“ç½®ä¸ºnilï¼Œå°±ä¸ä¼šå†è¯»å–å·²ç»å…³é—­çš„é€šé“äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="nx">fmat</span> <span class="p">=</span> <span class="s">&#34;2006-01-02 15:04:05&#34;</span><span class="kd">func</span> <span class="nf">closeChannelInFor</span><span class="p">()</span> <span class="p">{</span>	<span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>		<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>		<span class="nx">c</span> <span class="o">&lt;-</span> <span class="mi">10</span>		<span class="nb">close</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>	<span class="p">}()</span>	<span class="k">for</span> <span class="p">{</span>		<span class="k">select</span> <span class="p">{</span>		<span class="k">case</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="nx">c</span><span class="p">:</span>			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v, é€šé“è¯»å–åˆ°ï¼šx=%v, ok=%v\n&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Format</span><span class="p">(</span><span class="nx">fmat</span><span class="p">),</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">ok</span><span class="p">)</span>            <span class="c1">//if !ok {            //    c = nil            //}			time.Sleep(500*time.Millisecond)		default:			fmt.Printf(&#34;%v, é€šé“ä¹ˆæœ‰è¯»å–åˆ°æ•°æ®è¿›å…¥defult \n&#34;, time.Now().Format(fmat))			time.Sleep(500*time.Millisecond)		}	}}/*ç»“æœ2022-02-22 13:02:51, é€šé“ä¹ˆæœ‰è¯»å–åˆ°æ•°æ®è¿›å…¥defult 2022-02-22 13:02:52, é€šé“ä¹ˆæœ‰è¯»å–åˆ°æ•°æ®è¿›å…¥defult 2022-02-22 13:02:52, é€šé“è¯»å–åˆ°ï¼šx=10, ok=true2022-02-22 13:02:53, é€šé“è¯»å–åˆ°ï¼šx=0, ok=false2022-02-22 13:02:54, é€šé“è¯»å–åˆ°ï¼šx=0, ok=false2022-02-22 13:02:54, é€šé“è¯»å–åˆ°ï¼šx=0, ok=false2022-02-22 13:02:55, é€šé“è¯»å–åˆ°ï¼šx=0, ok=false2022-02-22 13:02:55, é€šé“è¯»å–åˆ°ï¼šx=0, ok=false2022-02-22 13:02:56, é€šé“è¯»å–åˆ°ï¼šx=0, ok=false*/
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>è€Œå¦‚æœåªæœ‰ä¸€ä¸ªcaseï¼Œåˆ™è¿˜æ˜¯ä¼šè¿›å…¥è¯¥caseï¼Œä½†æ˜¯å¦‚æœå°†å…¶ç½®ä¸ºnilï¼Œåˆ™ä¼šé€ æˆåç¨‹æ­»é”ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">closeChannelInForOneCase</span><span class="p">()</span> <span class="p">{</span>	<span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>		<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>		<span class="nx">c</span> <span class="o">&lt;-</span> <span class="mi">10</span>		<span class="nb">close</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>	<span class="p">}()</span>	<span class="k">for</span> <span class="p">{</span>		<span class="k">select</span> <span class="p">{</span>		<span class="k">case</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span> <span class="nx">c</span><span class="p">:</span>			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v, é€šé“è¯»å–åˆ°ï¼šx=%v, ok=%v\n&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Format</span><span class="p">(</span><span class="nx">fmat</span><span class="p">),</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">ok</span><span class="p">)</span>			<span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>				<span class="nx">c</span> <span class="p">=</span> <span class="kc">nil</span>			<span class="p">}</span>			<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">500</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>		<span class="p">}</span>	<span class="p">}}</span><span class="cm">/*ç»“æœ:2022-02-22 13:14:49, é€šé“è¯»å–åˆ°ï¼šx=10, ok=true2022-02-22 13:14:50, é€šé“è¯»å–åˆ°ï¼šx=0, ok=falsefatal error: all goroutines are asleep - deadlock!*/</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>æ‰€ä»¥è¯´<code>select</code>ä¸­å¦‚æœæœ‰æŸä¸ªé€šé“æœ‰å€¼å¯ä»¥è¯»çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œè¯¥<code>case</code>ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰<code>default</code>ï¼Œåˆ™æœ‰å¯èƒ½é€ æˆé˜»å¡ï¼Œç›´åˆ°æœ‰é€šé“å¯ä»¥è¿è¡Œã€‚</p>
<h4 id="21-defer-çš„ä½¿ç”¨">21. defer çš„ä½¿ç”¨</h4>
<p><code>defer</code>å…³é”®å­—å°±æ˜¯å®ç°åœ¨ä½œç”¨åŸŸç»“æŸä¹‹åæ‰§è¡Œå‡½æ•°çš„å…³é”®å­—ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯åœ¨å½“å‰å‡½æ•°æˆ–è€…æ˜¯æ–¹æ³•è¿”å›ä¹‹å‰è°ƒç”¨ä¸€äº›ç”¨äºæ”¶å°¾çš„å‡½æ•°ï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶ã€å…³é—­æ•°æ®åº“è¿æ¥ä»¥åŠè§£é”èµ„æºã€‚</p>
<h5 id="å¤šä¸ªdeferè¯­å¥çš„æ‰§è¡Œé¡ºåº">å¤šä¸ªdeferè¯­å¥çš„æ‰§è¡Œé¡ºåº</h5>
<p><code>defer</code>è¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œåœ¨ä»£ç ä¸­çš„ä½ç½®ç›¸å…³ï¼Œåœ¨å‡½æ•°æ‰§è¡Œè¯­å¥è¿”å›ä¹‹å‰ï¼ŒæŒ‰ç…§å…ˆè¿›åå‡ºçš„æ–¹å¼æ‰§è¡Œæ‰€æœ‰çš„<code>defer</code>è¯­å¥ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨<code>panic</code>è¯­å¥æ˜¯ä¾‹å¤–ã€‚<code>panic</code>ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œä½†æ˜¯ä¸ä¼šå½±å“<code>defer</code>è¯­å¥çš„è¿è¡Œã€‚</p>
<h5 id="deferçš„å€¼">deferçš„å€¼</h5>
<p><code>defer</code>ä¿®é¥°çš„è¯­å¥ä¸­çš„å€¼ï¼Œåœ¨è¯¥è¯­å¥å‡ºç°çš„æ—¶å€™ç¡®å®šï¼Œåç»­çš„æ‰§è¡Œå¹¶ä¸å½±å“ç»“æŸçš„æ—¶å€™è¯­å¥ä¸­çš„å€¼ï¼ˆéå¼•ç”¨ç±»å‹æˆ–è€…æ˜¯æŒ‡é’ˆï¼‰ã€‚å½“ <code>defer</code> è°ƒç”¨æ—¶å…¶å®ä¼šå¯¹å‡½æ•°ä¸­å¼•ç”¨çš„å¤–éƒ¨å‚æ•°è¿›è¡Œæ‹·è´ã€‚ä½†æ˜¯å¦‚æœæ‹·è´çš„æŒ‡é’ˆç±»å‹ï¼Œåˆ™è¿˜æ˜¯ä¼šå‡ºç°å˜åŒ–ã€‚</p>
<h4 id="22-selectçš„ä½¿ç”¨">22. selectçš„ä½¿ç”¨</h4>
<p><code>select</code>èƒ½å¤Ÿè®©åç¨‹åŒæ—¶ç­‰å¾…å¤šä¸ªé€šé“å¯è¯»æˆ–è€…å¯å†™ï¼Œåœ¨å¤šä¸ªæ–‡ä»¶æˆ–è€…æ˜¯é€šé“çŠ¶æ€æ”¹å˜ä¹‹å‰ï¼Œ<code>select</code>ä¼šä¸€è‡´é˜»å¡å½“å‰çš„åç¨‹ã€‚<code>select</code>å¯ä»¥åœ¨é€šé“ä¸Šè¿›è¡Œéé˜»å¡çš„æ‰‹æ³•æ“ä½œï¼Œå¹¶ä¸”å½“å¤šä¸ªé€šé“éƒ½å¯ä»¥è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œå°†ä¼šè¿›è¡Œéšæœºé€‰æ‹©ä¸€ä¸ª<code>case</code>è¿›è¡Œæ‰§è¡Œã€‚</p>
<h5 id="å…¸å‹åº”ç”¨">å…¸å‹åº”ç”¨</h5>
<ol>
<li>è¶…æ—¶åˆ¤æ–­ï¼Œå³ä¸€ä¸ª<code>case</code>ä½œä¸ºæ¥æ”¶æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ª<code>case</code>ä¸ºä¸€ä¸ª<code>time.After(...)</code>ã€‚åˆ™å½“ç¬¬ä¸€ä¸ª<code>case</code>åœ¨ä¸€å®šæ—¶é—´å†…é˜»å¡ï¼Œåˆ™å°†ä¼šæ‰§è¡Œå¦å¤–ä¸€ä¸ª<code>case</code>ï¼Œåˆ¤æ–­è¶…æ—¶ï¼Œåšå‡ºç›¸åº”çš„å¤„ç†ã€‚</li>
<li>åˆ¤æ–­é€šé“æ˜¯å¦é˜»å¡</li>
<li>ç”¨äºå¤šä¸ªåç¨‹åœ¨æŸä¸ªåç¨‹è¾¾åˆ°é€€å‡ºæ¡ä»¶çš„æ—¶å€™ï¼Œé€€å‡ºå…¶ä»–æ‰€æœ‰çš„åç¨‹ã€‚</li>
</ol>
<h4 id="23-å¦‚ä½•ä»panicä¸­æ¢å¤">23. å¦‚ä½•ä»panicä¸­æ¢å¤ï¼Ÿ</h4>
<p>â€‹	åœ¨äº†è§£å¦‚ä½•ä»<code>panic</code>ä¸­æ¢å¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£<code>panic</code>çš„æœºåˆ¶ã€‚<code>panic</code>ä¼šæ”¹å˜ç¨‹åºçš„æ§åˆ¶æµï¼Œè°ƒç”¨<code>panic</code>ä¹‹åä¼šç«‹åˆ»åœæ­¢æ‰§è¡Œå½“å‰å‡½æ•°çš„å‰©ä½™ä»£ç ï¼Œå¹¶åœ¨å½“å‰åç¨‹ä¸­é€’å½’æ‰§è¡Œè°ƒç”¨æ–¹çš„<code>defer</code>ã€‚è€Œ<code>recover</code>å¯ä»¥ä¸­å€¼<code>panic</code>é€ æˆçš„ç¨‹åºå´©æºƒï¼Œå¥¹æ˜¯ä¸€ä¸ªåªèƒ½åœ¨<code>defer</code>ä¸­å‘æŒ¥ä½œç”¨çš„å‡½æ•°ï¼Œåœ¨å…¶ä»–ä½œç”¨åŸŸæ˜¯ä¸ä¼šå‘æŒ¥ä½œç”¨çš„ã€‚</p>
<ul>
<li><code>panci</code>åªä¼šè§¦å‘å½“å‰åç¨‹çš„<code>defer</code>ã€‚</li>
<li><code>recover</code>åªæœ‰åœ¨<code>defer</code>ä¸­è°ƒç”¨æ‰ä¼šæœ‰æ•ˆã€‚</li>
<li><code>panic</code>å…è®¸åœ¨<code>defer</code>ä¸­åµŒå¥—å¤šæ¬¡ä½¿ç”¨ã€‚</li>
</ul>
<p>æ‰€ä»¥è¯´æˆ‘ä»¬ä»<code>panic</code>ä¸­æ¢å¤çš„è¯ï¼Œéœ€è¦å°†<code>recover</code>è¯­å¥æ”¾ç½®åœ¨<code>defer</code>å…³é”®è¯ä¹‹åã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">badCall</span><span class="p">()</span> <span class="p">{</span>    <span class="nb">panic</span><span class="p">(</span><span class="s">&#34;bad end&#34;</span><span class="p">)}</span><span class="kd">func</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>        <span class="k">if</span> <span class="nx">e</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">e</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Panicing %s\r\n&#34;</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>        <span class="p">}</span>    <span class="p">}()</span>    <span class="nf">badCall</span><span class="p">()</span>    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;After bad call\r\n&#34;</span><span class="p">)</span> <span class="c1">// &lt;-- wordt niet bereikt}func main() {    fmt.Printf(&#34;Calling test\r\n&#34;)    test()    fmt.Printf(&#34;Test completed\r\n&#34;)}/*ç»“æœCalling testPanicing bad endTest completed*/
</span></code></pre></td></tr></table>
</div>
</div><h4 id="24-å¦‚ä½•é¿å…å†…å­˜é€ƒé€¸">24. å¦‚ä½•é¿å…å†…å­˜é€ƒé€¸</h4>
<p>â€‹	å†…å­˜é€ƒé€¸å°±æ˜¯å€¼å¾—å±€éƒ¨å˜é‡ï¼ˆå­˜åœ¨æ ˆä¸Šï¼‰æ²¡æœ‰åœ¨æ ˆä¸Šè¿›è¡Œå›å½’ï¼Œè€Œæ˜¯è¿›å…¥åˆ°å †ä¸­ï¼Œåœ¨å †ä¸­è¢«å›æ”¶ï¼Œå°±å«åšå†…å­˜é€ƒé€¸ã€‚æ‰€ä»¥é¿å…å†…å­˜é€ƒé€¸å°±æ˜¯é¿å…å±€éƒ¨å˜é‡è¿›å…¥åˆ°å †ä¸­ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œ<code>go build -gcflags=-m</code>æŸ¥çœ‹å†…å­˜é€ƒé€¸ï¼Œå†…å­˜é€ƒé€¸å‘ç”Ÿçš„åŸå› æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol>
<li>å‘<code>chan</code>å‘é€æŒ‡é’ˆæ•°æ®ã€‚ç”±äºåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¸çŸ¥é“è¯¥æ•°æ®ä¼šè¢«å“ªä¸ªgoroutineæ¥æ”¶ï¼Œæ‰€ä»¥ä¸çŸ¥é“è¿™ä¸ªå±€éƒ¨å˜é‡ä»€ä¹ˆæ—¶å€™æ‰èƒ½é‡Šæ”¾ï¼Œæ‰€ä»¥åªèƒ½æ”¾åˆ°å †ä¸­ï¼Œåœ¨å †ä¸­ç­‰å¾…è¢«å›æ”¶ã€‚</li>
<li>å±€éƒ¨å˜é‡åœ¨å‡½æ•°è°ƒç”¨ç»“æŸåè¿˜è¢«å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼Œæ¯”å¦‚å‡½æ•°è¿”å›å±€éƒ¨å˜é‡æŒ‡é’ˆæˆ–é—­åŒ…ä¸­å¼•ç”¨åŒ…å¤–çš„å€¼ã€‚å› ä¸ºå˜é‡çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä¼šè¶…è¿‡å‡½æ•°å‘¨æœŸï¼Œå› æ­¤åªèƒ½æ”¾å…¥å †ä¸­ã€‚</li>
<li>åœ¨ slice æˆ– map ä¸­å­˜å‚¨æŒ‡é’ˆã€‚æ¯”å¦‚ []*stringï¼Œå…¶åé¢çš„æ•°ç»„å¯èƒ½æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼Œä½†å…¶å¼•ç”¨çš„å€¼è¿˜æ˜¯åœ¨å †ä¸Šã€‚</li>
<li>åˆ‡ç‰‡æ‰©å®¹åé•¿åº¦å¤ªå¤§ï¼Œå¯¼è‡´æ ˆç©ºé—´ä¸è¶³ï¼Œé€ƒé€¸åˆ°å †ä¸Šã€‚åˆå§‹åŒ–çš„æ—¶å€™æ˜¯åœ¨æ ˆä¸Šè¿›è¡Œåˆ†é…ï¼Œè¿è¡Œæ—¶æ•°æ®æ‰©å……åˆ™è¦åœ¨å¯¹ä¸Šè¿›è¡Œåˆ†é…ï¼Œä½†æ˜¯åˆå§‹åŒ–çš„æ—¶å€™ä¸çŸ¥é“å®¹é‡å¤§å°ï¼Œåˆ™ä¼šç›´æ¥åœ¨å †ä¸Šè¿›è¡Œåˆ†é…ã€‚</li>
<li>åœ¨ interface ç±»å‹ä¸Šè°ƒç”¨æ–¹æ³•ã€‚ åœ¨ interface ç±»å‹ä¸Šè°ƒç”¨æ–¹æ³•æ—¶ä¼šæŠŠinterfaceå˜é‡ä½¿ç”¨å †åˆ†é…ï¼Œ å› ä¸ºæ–¹æ³•çš„çœŸæ­£å®ç°åªèƒ½åœ¨è¿è¡Œæ—¶çŸ¥é“ã€‚</li>
</ol>
<p>é’ˆå¯¹å‘ç”Ÿå†…å­˜é€ƒé€¸çš„åŸå› æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥é¿å…å†…å­˜é€ƒé€¸ï¼š</p>
<ol>
<li>å¯¹äºå°å‹çš„æ•°æ®ï¼Œä½¿ç”¨ä¼ å€¼è€Œä¸æ˜¯ä¼ æŒ‡é’ˆï¼Œé¿å…å†…å­˜é€ƒé€¸ã€‚</li>
<li>é¿å…ä½¿ç”¨é•¿åº¦ä¸å›ºå®šçš„sliceåˆ‡ç‰‡ï¼Œåœ¨ç¼–è¯‘æœŸæ— æ³•ç¡®å®šåˆ‡ç‰‡é•¿åº¦ï¼Œåªèƒ½å°†åˆ‡ç‰‡ä½¿ç”¨å †åˆ†é…ã€‚</li>
<li>interfaceè°ƒç”¨æ–¹æ³•ä¼šå‘ç”Ÿå†…å­˜é€ƒé€¸ï¼Œåœ¨çƒ­ç‚¹ä»£ç ç‰‡æ®µï¼Œè°¨æ…ä½¿ç”¨ã€‚</li>
</ol>
<h4 id="25-goroutine-æ³„éœ²">25. Goroutine æ³„éœ²</h4>
<p>goroutineæ³„éœ²çš„åŸå› ä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šæ€»ç»“æ¥çœ‹ï¼Œåªè¦å‘ç”Ÿäº†é˜»å¡ï¼Œå°±ä¼šäº§ç”ŸGououtineæ³„éœ²ã€‚</p>
<ol>
<li>goroutineä¸­æ­£åœ¨è¿›è¡Œchannelçš„è¯»å†™æ“ä½œï¼Œä½†æ˜¯å› ä¸ºä»£ç é€»è¾‘é—®é¢˜ï¼Œå¯¼è‡´ä¸€ç›´è¢«é˜»å¡ã€‚</li>
<li>goroutineå†…çš„ä¸šåŠ¡é€»è¾‘è¿›å…¥æ­»å¾ªç¯ï¼Œèµ„æºä¸€ç›´æ— æ³•è¢«é‡Šæ”¾ã€‚</li>
<li>goroutineå†…çš„ä¸šåŠ¡é€»è¾‘è¿›å…¥é•¿æ—¶é—´çš„ç­‰å¾…ï¼Œå¹¶ä¸”æœ‰ä¸æ–­æ–°å¢çš„goroutineè¿›å…¥ç­‰å¾…ã€‚</li>
</ol>
<p>é€ æˆé˜»å¡çš„åŸå› å¤§å¤šå¯ä»¥åˆ†ä¸ºï¼š</p>
<ol>
<li>å‘é€šé“ä¸­å‘é€æ•°æ®ï¼Œä½†æ˜¯æ²¡æœ‰ä»é€šé“ä¸­å–å‡ºæ•°æ®ã€‚æˆ–è€…æ˜¯æƒ³ä»é€šé“ä¸­å–å‡ºæ•°æ®ï¼Œä½†æ˜¯æ²¡æœ‰å‘é€šé“ä¸­å‘é€æ•°æ®ã€‚</li>
<li>é€šé“æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œä½¿ç”¨äº†nilé€šé“</li>
<li>æ²¡æœ‰é˜»å¡ï¼Œä½†æ˜¯ä¸€ä¸ªæ“ä½œç­‰å¾…æ—¶é—´æ¯”è¾ƒé•¿ï¼ˆä¾‹å¦‚åœ¨è·å–ç½‘é¡µå†…å®¹çš„æ—¶å€™ï¼Œç”±äºç½‘é€Ÿé—®é¢˜ï¼Œå¹¶ä¸”æ²¡æœ‰è®¾ç½®è¶…æ—¶ï¼Œæ— æ³•è¿›è¡Œå¤ç”¨ï¼‰ï¼Œå°±ä¼šå¯¼è‡´<code>goroutine</code>çš„æ•°é‡è¶Šæ¥è¶Šå¤šã€‚</li>
<li>é”ä½¿ç”¨ä¸å½“ï¼ŒåŠ é”å¿˜è®°é‡Šæ”¾é”ï¼Œæˆ–è€…æ˜¯åŒæ­¥é”ä½¿ç”¨</li>
</ol>
<h5 id="æ’æŸ¥æ–¹æ³•">æ’æŸ¥æ–¹æ³•</h5>
<ol>
<li>
<p>å¯ä»¥ä½¿ç”¨<code>runtime.NumGoroutine</code>æ¥è·å–Goroutineçš„è¿è¡Œæ•°é‡ï¼Œç„¶åå‰åè¿›è¡Œæ¯”è¾ƒï¼Œå°±å¯ä»¥çŸ¥é“æ˜¯å¦æ³„éœ²äº†ã€‚</p>
</li>
<li>
<p>åœ¨ä¸šåŠ¡è¿è¡Œåœºæ™¯ä¸­ï¼Œä¸€èˆ¬å¯ä»¥ç›´æ¥ä½¿ç”¨PProfã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>    <span class="s">&#34;net/http&#34;</span>     <span class="nx">_</span> <span class="s">&#34;net/http/pprof&#34;</span><span class="p">)</span><span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;localhost:6060&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h4 id="26-å†…å­˜æ³„éœ²é—®é¢˜">26. å†…å­˜æ³„éœ²é—®é¢˜</h4>
<p>â€‹	é¦–å…ˆè¦è¯´æ˜çš„å†…å­˜æ³„æ¼å’Œå†…å­˜é€ƒé€¸æ˜¯ä¸åŒçš„æ¦‚å¿µï¼Œå†…å­˜æ³„éœ²æ˜¯ä¸€éƒ¨åˆ†å†…å­˜æ— æ³•å¾—åˆ°å›æ”¶ã€‚è€Œå†…å­˜é€ƒé€¸åªæ˜¯å±€éƒ¨å˜é‡ä»æ ˆè·‘åˆ°å †ä¸­ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šè¢«å›æ”¶ï¼Œå¦‚æœåœ¨è¿™ä¸ªé˜¶æ®µä¸è¢«å›æ”¶æ‰æ˜¯å†…å­˜æ³„éœ²ã€‚é€ æˆå†…å­˜æ³„éœ²çš„åŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>è·å–é•¿å­—ç¬¦ä¸²çš„ä¸€æ®µå¯¼è‡´é•¿å­—ç¬¦ä¸²æœªé‡Šæ”¾ã€‚</li>
<li>è·å–é•¿åˆ‡ç‰‡çš„ä¸€æ®µå¯¼è‡´é•¿åˆ‡ç‰‡æ²¡æœ‰é‡Šæ”¾ã€‚</li>
<li>åœ¨é•¿åˆ‡ç‰‡ä¸­æ–°å»ºåˆ‡ç‰‡å¯¼è‡´æ³„éœ²ã€‚</li>
<li>goroutineæ³„éœ²ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯ç”±äºgoroutineé˜»å¡å¼•èµ·çš„ã€‚</li>
<li><code>time.Ticker</code>æ²¡æœ‰å…³é—­å¯¼è‡´æ³„éœ²ã€‚</li>
<li><code>Finalizer</code>å¯¼è‡´æ³„éœ²ã€‚</li>
<li><code>Deferring Function Call</code>å¯¼è‡´æ³„éœ²ã€‚</li>
</ol>
<h4 id="27-syncpoolçš„é€‚ç”¨åœºæ™¯">27. sync.Poolçš„é€‚ç”¨åœºæ™¯</h4>
<p>â€‹	<code>sync.Pool</code>æ˜¯ä¸€ä¸ªå•ç‹¬ä¿å­˜å’Œæ£€ç´¢çš„ä¸´æ—¶å¯¹è±¡ã€‚å…¶ç›®çš„æ˜¯ä¸ºäº†ç¼“å­˜å·²ç»åˆ†é…åˆ°é‚£æ—¶æ²¡æœ‰ä½¿ç”¨çš„å…ƒç´ ä»¥ä¾¿äºåç»­é‡ç”¨ã€‚å…¶ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å¯ä»¥å‡è½»åƒåœ¾æ”¶é›†å™¨çš„å‹åŠ›ï¼Œè€Œä¸”ä»–æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚æ‰€ä»¥å…¶å¯ä»¥å¾ˆå®¹æ˜“çš„æ„æˆé«˜æ•ˆã€å¹¶å‘å®‰å…¨çš„ç©ºé—²åˆ—è¡¨ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å°±æ˜¯åœ¨<code>fmt.Printf</code>ä¸­ï¼Œç®¡ç†äº†ä¸€ä¸ªåŠ¨æ€å¤§å°ç”¨äºå­˜å‚¨è¾“å‡ºçš„ç¼“å†²åŒºã€‚ä¸‹é¢æ˜¯å®˜æ–¹æºç æ³¨é‡Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">A</span> <span class="nx">Pool</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">temporary</span> <span class="nx">objects</span> <span class="nx">that</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">individually</span> <span class="nx">saved</span> <span class="nx">andretrieved</span><span class="p">.</span><span class="nx">Any</span> <span class="nx">item</span> <span class="nx">stored</span> <span class="nx">in</span> <span class="nx">the</span> <span class="nx">Pool</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">removed</span> <span class="nx">automatically</span> <span class="nx">at</span> <span class="nx">any</span> <span class="nx">time</span> <span class="nx">withoutnotification</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">the</span> <span class="nx">Pool</span> <span class="nx">holds</span> <span class="nx">the</span> <span class="nx">only</span> <span class="nx">reference</span> <span class="nx">when</span> <span class="nx">this</span> <span class="nx">happens</span><span class="p">,</span> <span class="nx">theitem</span> <span class="nx">might</span> <span class="nx">be</span> <span class="nx">deallocated</span><span class="p">.</span><span class="nx">A</span> <span class="nx">Pool</span> <span class="nx">is</span> <span class="nx">safe</span> <span class="k">for</span> <span class="nx">use</span> <span class="nx">by</span> <span class="nx">multiple</span> <span class="nx">goroutines</span> <span class="nx">simultaneously</span><span class="p">.</span><span class="nx">Pool</span><span class="err">&#39;</span><span class="nx">s</span> <span class="nx">purpose</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">cache</span> <span class="nx">allocated</span> <span class="nx">but</span> <span class="nx">unused</span> <span class="nx">items</span> <span class="k">for</span> <span class="nx">later</span> <span class="nx">reuse</span><span class="p">,</span><span class="nx">relieving</span> <span class="nx">pressure</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">garbage</span> <span class="nx">collector</span><span class="p">.</span> <span class="nx">That</span> <span class="nx">is</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">makes</span> <span class="nx">it</span> <span class="nx">easy</span> <span class="nx">tobuild</span> <span class="nx">efficient</span><span class="p">,</span> <span class="nx">thread</span><span class="o">-</span><span class="nx">safe</span> <span class="nx">free</span> <span class="nx">lists</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">suitable</span> <span class="k">for</span> <span class="nx">allfree</span> <span class="nx">lists</span><span class="p">.</span><span class="nx">An</span> <span class="nx">appropriate</span> <span class="nx">use</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">Pool</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">manage</span> <span class="nx">a</span> <span class="nx">group</span> <span class="nx">of</span> <span class="nx">temporary</span> <span class="nx">itemssilently</span> <span class="nx">shared</span> <span class="nx">among</span> <span class="nx">and</span> <span class="nx">potentially</span> <span class="nx">reused</span> <span class="nx">by</span> <span class="nx">concurrent</span> <span class="nx">independentclients</span> <span class="nx">of</span> <span class="nx">a</span> <span class="kn">package</span><span class="p">.</span> <span class="nx">Pool</span> <span class="nx">provides</span> <span class="nx">a</span> <span class="nx">way</span> <span class="nx">to</span> <span class="nx">amortize</span> <span class="nx">allocation</span> <span class="nx">overheadacross</span> <span class="nx">many</span> <span class="nx">clients</span><span class="p">.</span><span class="nx">An</span> <span class="nx">example</span> <span class="nx">of</span> <span class="nx">good</span> <span class="nx">use</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">Pool</span> <span class="nx">is</span> <span class="nx">in</span> <span class="nx">the</span> <span class="nx">fmt</span> <span class="kn">package</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">maintains</span> <span class="nx">adynamically</span><span class="o">-</span><span class="nx">sized</span> <span class="nx">store</span> <span class="nx">of</span> <span class="nx">temporary</span> <span class="nx">output</span> <span class="nx">buffers</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">store</span> <span class="nx">scales</span> <span class="nf">underload</span> <span class="p">(</span><span class="nx">when</span> <span class="nx">many</span> <span class="nx">goroutines</span> <span class="nx">are</span> <span class="nx">actively</span> <span class="nx">printing</span><span class="p">)</span> <span class="nx">and</span> <span class="nx">shrinks</span> <span class="nx">whenquiescent</span><span class="p">.</span><span class="nx">On</span> <span class="nx">the</span> <span class="nx">other</span> <span class="nx">hand</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">free</span> <span class="nx">list</span> <span class="nx">maintained</span> <span class="nx">as</span> <span class="nx">part</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">short</span><span class="o">-</span><span class="nx">lived</span> <span class="nx">object</span> <span class="nx">isnot</span> <span class="nx">a</span> <span class="nx">suitable</span> <span class="nx">use</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">Pool</span><span class="p">,</span> <span class="nx">since</span> <span class="nx">the</span> <span class="nx">overhead</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">amortize</span> <span class="nx">well</span> <span class="nx">inthat</span> <span class="nx">scenario</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">is</span> <span class="nx">more</span> <span class="nx">efficient</span> <span class="nx">to</span> <span class="nx">have</span> <span class="nx">such</span> <span class="nx">objects</span> <span class="nx">implement</span> <span class="nx">their</span> <span class="nx">ownfree</span> <span class="nx">list</span><span class="p">.</span><span class="nx">A</span> <span class="nx">Pool</span> <span class="nx">must</span> <span class="nx">not</span> <span class="nx">be</span> <span class="nx">copied</span> <span class="nx">after</span> <span class="nx">first</span> <span class="nx">use</span><span class="p">.</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="28-å¯¹å·²ç»å…³é—­çš„chanè¿›è¡Œè¯»å†™ä¼šå‘ç”Ÿä»€ä¹ˆå¦‚æœæ˜¯æœªåˆå§‹åŒ–çš„chanå‘¢">28. å¯¹å·²ç»å…³é—­çš„<code>chan</code>è¿›è¡Œè¯»å†™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå¦‚æœæ˜¯æœªåˆå§‹åŒ–çš„<code>chan</code>å‘¢ï¼Ÿ</h4>
<p>å¯¹äºå·²ç»å…³é—­çš„<code>chan</code>éœ€è¦åˆ†æƒ…å†µï¼Œæƒ…å†µå¦‚ä¸‹ï¼š</p>
<ol>
<li>è¯»å·²ç»å…³é—­çš„é€šé“ä¼šä¸€ç›´è¯»å‡ºä¿¡æ¯ï¼Œä½†æ˜¯ä¿¡æ¯æ˜¯ä»€ä¹ˆä¼šæ ¹æ®é€šé“ä¸­æ˜¯å¦è¿˜æœ‰æ•°æ®æ¥å†³å®šçš„ã€‚
<ul>
<li>ç¬¬ä¸€ç§æƒ…å†µå¦‚æœæ˜¯å…³é—­çš„é€šé“è¿˜æœ‰æ•°æ®ï¼Œåˆ™ä¼šå°†æ•°æ®è¯»å‡ºï¼Œè¿”å›å€¼ç¬¬ä¸€ä¸ªä¸ºå–å‡ºçš„æ•°æ®ï¼Œç¬¬äºŒä¸ªä¸ºæ ‡å¿—æ˜¯å¦è¯»å–æˆåŠŸçš„æ ‡å¿—ä¸º<code>true</code>ã€‚</li>
<li>ç¬¬äºŒç§æƒ…å†µå…³é—­çš„é€šé“ä¸­å·²ç»æ²¡æœ‰æ•°æ®äº†ï¼Œæ­¤æ—¶è¯»å‡ºçš„æ•°æ®ä¸ºé€šé“ä¸­å­˜å‚¨æ•°æ®ç±»å‹çš„é›¶å€¼ï¼Œç¬¬äºŒä¸ªæ ‡å¿—ä½ä¸º<code>false</code>ã€‚</li>
</ul>
</li>
<li>å‘å·²ç»å…³é—­çš„é€šé“å†™æ•°æ®ä¼šå¯¼è‡´<code>panic</code>ã€‚</li>
</ol>
<p>å¦‚æœæ˜¯æœªåˆå§‹åŒ–çš„<code>chan</code>ï¼Œä»<code>chan</code>ä¸­è¯»å–æ•°æ®ä¼šå¯¼è‡´ä¸€ç›´é˜»å¡ï¼ŒåŒæ—¶å‘<code>chan</code>ä¸­å†™å…¥æ•°æ®ä¹Ÿä¼šå¯¼è‡´é˜»å¡ã€‚</p>
<h4 id="29-syncmapçš„ä¼˜ç¼ºç‚¹å’Œä½¿ç”¨åœºæ™¯">29. <code>sync.map</code>çš„ä¼˜ç¼ºç‚¹å’Œä½¿ç”¨åœºæ™¯</h4>
<p>ç”±äºgoä¸­çš„mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œgoæä¾›äº†<code>sync.map</code>ç”¨äºå¹¶å‘ä½¿ç”¨ã€‚ ä»å®˜æ–¹æºç æ³¨é‡Šä¸Šæˆ‘ä»¬äº†è§£åˆ°ï¼Œ<code>sync.map</code>ä¸»è¦æ›´é€‚åˆä»¥ä¸‹ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼ˆå¯¹å…¶ä¸“é—¨åšäº†ä¼˜åŒ–ï¼‰ï¼Œåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ä½¿ç”¨<code>sync.map</code>æ¯”ä½¿ç”¨æ™®é€š<code>map</code>åŠ ä¸Š<code>MUtexã€RWMutex</code>æ€§èƒ½è¦å¥½å¾ˆå¤šã€‚å…¶å·¥ä½œåŸç†å°±æ˜¯åœ¨å†™çš„æ—¶å€™ç›´æ¥é‚ªå†™å…¥åˆ°<code>dirty map</code>ï¼Œè¯»å–çš„æ—¶å€™å…ˆè¯»<code>read map</code>å¦‚æœ<code>read map</code>ä¸­æ²¡æœ‰å†å»è¯»<code>dirty map</code>ã€‚å°±æ˜¯è¯»å†™åˆ†ç¦»ï¼Œç©ºé—´æ¢å–æ—¶é—´ã€‚</p>
<ol>
<li>å¯¹äºmapä¸­å…ƒç´ å¤šè¯»å°‘å†™çš„æƒ…å†µã€‚</li>
<li>å¤šä¸ªgoroutineè¯»å–å’Œå†™å…¥æ˜¯<code>key</code>æ²¡æœ‰ç›¸å…³çš„å…ƒç´ çš„æƒ…å†µã€‚å³æ’å…¥å…ƒç´ æˆ–è€…è¯»å–å…ƒç´ åˆ†æ•£æ€§å¼ºã€‚</li>
</ol>
<p>æ‰€ä»¥å…¶ä¼˜ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ã€‚</p>
<p>ä¼˜ç‚¹ï¼šé€šè¿‡è¯»å†™åˆ†ç¦»ï¼Œé™ä½é”æ—¶é—´æ¥æé«˜æ€§èƒ½</p>
<p>ç¼ºç‚¹ï¼šä¸é€‚ç”¨äºå¤§é‡å†™çš„åœºæ™¯(å¤§é‡å†™çš„åœºæ™¯å¯ä»¥ä½¿ç”¨æ™®é€šmap+é”çš„æ–¹å¼)ï¼Œè¿™æ ·ä¼šå¯¼è‡´read <strong>map</strong>è¯»ä¸åˆ°æ•°æ®è€Œè¿›ä¸€æ­¥åŠ é”è¯»å–ï¼ŒåŒæ—¶dirty <strong>map</strong>ä¹Ÿä¼šä¸€ç›´æ™‹å‡ä¸ºread <strong>map</strong>ï¼Œæ•´ä½“æ€§èƒ½è¾ƒå·®ã€‚</p>
<h4 id="30--å¦‚ä½•è®©ä¸»åç¨‹ç­‰å¾…å­åç¨‹å®Œæˆä¹‹åå†ç»§ç»­æ‰§è¡Œ">30.  å¦‚ä½•è®©ä¸»åç¨‹ç­‰å¾…å­åç¨‹å®Œæˆä¹‹åå†ç»§ç»­æ‰§è¡Œ?</h4>
<p>è¿™ä¸€ç‚¹æ¶‰åŠåˆ°äº†å¹¶å‘åŒæ­¥é—®é¢˜ï¼Œä¸€èˆ¬ç®€å•æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>ä½¿ç”¨é€šé“ä¼ é€’ä¿¡å·é‡ï¼Œå…¶å®å°±æ˜¯å˜ç›¸æ¨¡ä»¿<code>sync.WaitGroup</code>ã€‚å³æ¯ä¸ªgoroutineå®Œæˆä¹‹åå‘é€šé“ä¸­å†™å…¥æ¶ˆæ¯ï¼Œè€Œä¸»goroutineåˆ™ä¼šé€šè¿‡<code>for range</code>æ¥åˆ¤æ–­å­goroutineæ˜¯å¦å®Œæˆã€‚</li>
<li>ä½¿ç”¨<code>sync.WaitGourp</code>ï¼Œå³å¼€å§‹æ—¶é—´ä½¿ç”¨<code>Add()</code>æ–¹æ³•ç¡®è®¤æœ‰å¤šå°‘ä¸ªå­åç¨‹ï¼Œåœ¨å­goroutineä¸­å®Œæˆä¸šåŠ¡ä»£ç åè°ƒç”¨<code>Done()</code>æ–¹æ³•ï¼Œä¸»goroutineä¸­è°ƒç”¨<code>Wait()</code>æ–¹æ³•ç­‰å¾…å­goroutineçš„å®Œæˆã€‚</li>
</ol>
<h4 id="31-channelæœ‰æ— ç¼“å­˜æœ‰ä½•åŒºåˆ«">31. channelæœ‰æ— ç¼“å­˜æœ‰ä½•åŒºåˆ«ï¼Ÿ</h4>
<p>â€‹	å¸¦ç¼“å­˜çš„channelå’Œä¸å¸¦ç¼“å­˜çš„channelæœ€å¤§çš„åŒºåˆ«å°±åœ¨äºæ— ç¼“å­˜çš„çš„channelå¦‚æœå‘é€æ–¹æˆ–è€…æ¥æ”¶æ–¹æ²¡æœ‰å‡†å¤‡å¥½å°±ä¼šè¢«é˜»å¡ï¼Œæ‰€ä»¥æ— ç¼“å­˜çš„channelä¸€èˆ¬ç”¨äºéœ€è¦åŒæ­¥çš„åœºæ™¯ä¸­ã€‚è€Œæœ‰ç¼“å­˜çš„channelåªæœ‰åœ¨ç¼“å†²åŒºè¢«å†™å…¥æ»¡äº†å¹¶ä¸”æ²¡æœ‰è¯»å–æ‰ä¼šé˜»å¡å†™å…¥ã€‚</p>
<h4 id="32-goroutineçš„å¹¶å‘æ§åˆ¶">32. goroutineçš„å¹¶å‘æ§åˆ¶</h4>
<p>goroutineåªèƒ½ç”±è‡ªå·±æœ¬èº«æ§åˆ¶åœ¨ä½•ç§æƒ…å†µä¸‹é€€å‡ºï¼Œå¤–ç•Œä¸€èˆ¬æ— æ³•å¼ºåˆ¶ç»“æŸï¼ˆç¨‹åºå´©æºƒæˆ–è€…æ˜¯mainå‡½æ•°ç»“æŸé™¤å¤–ï¼‰ã€‚è€Œé’ˆå¯¹goroutineçš„å¹¶å‘æ§åˆ¶ç±»å‹åªåˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p>
<ol>
<li>
<p>å…¨å±€å…±äº«å˜é‡</p>
<p>å…¨å±€å…±äº«å˜é‡æ˜¯ä¸€ç§æœ€ç®€å•çš„æ§åˆ¶å¹¶å‘çš„æ–¹å¼ã€‚ä¸€èˆ¬çš„å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡</li>
<li>æ‰€æœ‰å­goroutineå…±äº«è¿™ä¸ªå˜é‡ï¼Œå¹¶ä¸”ä¸æ–­è½®è¯¢è¿™ä¸ªå˜é‡æ£€æŸ¥æ˜¯å¦æ›´æ–°</li>
<li>åœ¨ä¸»goroutineä¸­å˜æ›´è¯¥å…¨å±€å˜é‡</li>
<li>å­goroutineæ£€æµ‹åˆ°å˜é‡æ›´æ–°ç„¶åæ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚</li>
</ul>
<p>å…¶ä¼˜ç‚¹å°±æ˜¯å®ç°ç®€å•ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯åªèƒ½å¤šè¯»ä¸€å†™ï¼Œå¦‚æœæƒ³è¦å¤šå†™ï¼Œå°±éœ€è¦è§£å†³å…¨å±€å…±äº«å˜é‡çš„åŒæ­¥é—®é¢˜ï¼Œä¾‹å¦‚ç»™ä»–åŠ ä¸Šé”ï¼Œä½†æ˜¯è¿™æ ·ä¼šé™ä½æ€§èƒ½ï¼Œå¢åŠ å®ç°å¤æ‚åº¦ï¼Œå¹¶ä¸”ä¸é€‚åˆåœ¨å­goroutineé—´è¿›è¡Œé€šä¿¡ã€‚è€Œä¸”ç”±äºæ˜¯å•å‘é€šä¿¡ï¼Œæ‰€ä»¥åªèƒ½ç”±ä¸»goroutineå‘å­goroutineè¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥ä¸»goroutineæ— æ³•ç²¾ç¡®ç­‰å¾…å­goroutineå®Œæˆä¹‹åå†é€€å‡ºã€‚</p>
</li>
<li>
<p>channelé€šä¿¡</p>
<p>channelé€šä¿¡æ§åˆ¶åŸºäºCSPæ¨¡å‹ï¼Œé¿å…äº†å¤§é‡åŠ é”è§£é”çš„æ€§èƒ½æ¶ˆè€—ï¼Œè€Œä¸”æ¯”Actoræ¨¡å‹æ›´åŠ çµæ´»ã€‚è€Œä½¿ç”¨channelè¿›è¡Œé€šä¿¡ä¸€èˆ¬ç”¨çš„æœ€å¤šçš„è¿˜æœ‰<code>selectã€for rangeã€sync.WaitGroup</code>ç­‰ç­‰ã€‚</p>
</li>
<li>
<p>ContextåŒ…</p>
<p>contexté€šå¸¸å«åšä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥å°†ä¸€äº›æ•°æ®å°è£…åœ¨contextå˜é‡ä¸­ã€‚æœ€å¸¸è§çš„å°±æ˜¯å†ç½‘ç»œç¼–ç¨‹ä¸‹ï¼Œè·å–åˆ°ä¸€ä¸ªè¯·æ±‚ä¹‹åï¼Œå¯èƒ½ä¼šå¯¹è¿™ä¸ªè¯·æ±‚å¼€å¯æ–°çš„å­goroutineè¿›è¡Œåç»­å¤„ç†ã€‚æ‰€ä»¥å¯ä»¥å°†ä¿¡æ¯å°è£…å†contextä¸­ç”¨äºé€šä¿¡å’Œæ§åˆ¶ã€‚</p>
</li>
</ol>
<h4 id="33--channelçš„åº•å±‚å®ç°">33.  channelçš„åº•å±‚å®ç°</h4>
<p>â€‹	é¦–å…ˆè¯´æ˜ä¸€ç‚¹ï¼Œchannelæœ¬èº«å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯å †ä¸­åˆ†é…çš„ä¸€ä¸ª<code>hchan</code>çš„ç»“æ„ä½“ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹å³æ²¡æœ‰é˜»å¡å‘ç”Ÿçš„æƒ…å†µï¼Œ<code>sendx</code>è¡¨ç¤ºåœ¨å¹»æƒ³é“¾è¡¨ä¸­<code>chan</code>æ¥æ”¶çš„å…ƒç´ å°†ä¼šå­˜æ”¾çš„ç´¢å¼•ï¼Œè€Œ<code>recvx</code>è¡¨ç¤º<code>chan</code>å°†ä¼šå‘é€çš„æ•°æ®åœ¨ç¯å½¢é“¾è¡¨ä¸­æ‰€åœ¨çš„ç´¢å¼•ã€‚è€Œå¦‚æœç¼“å­˜æ»¡äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ä¼šé˜»å¡å½“å‰çš„goroutineã€‚å¹¶å°†å«æœ‰å½“å‰goroutineçš„æŒ‡é’ˆå’Œè¦sendçš„å…ƒç´ æ”¾å…¥åˆ°<code>sendq</code>é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«å”¤é†’ï¼Œå¦‚æœæ˜¯è¦<code>recv</code>è¢«é˜»å¡åˆ™ç›¸åº”çš„æ”¾å…¥åˆ°<code>sendq</code>ä¸­ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">hchan</span> <span class="kd">struct</span> <span class="p">{</span>	<span class="nx">qcount</span>   <span class="kt">uint</span>           <span class="c1">// total data in the queue	dataqsiz uint           // size of the circular queue	buf      unsafe.Pointer // points to an array of dataqsiz elements	elemsize uint16	closed   uint32	elemtype *_type // element type	sendx    uint   // send index	recvx    uint   // receive index	recvq    waitq  // list of recv waiters	sendq    waitq  // list of send waiters	// lock protects all fields in hchan, as well as several	// fields in sudogs blocked on this channel.	//	// Do not change another G&#39;s status while holding this lock	// (in particular, do not ready a G), as this can deadlock	// with stack shrinking.	lock mutex}
</span></code></pre></td></tr></table>
</div>
</div><p>å…·ä½“è¯¦è§£æŸ¥çœ‹å¼•ç”¨7ã€‚å€¼å¾—æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯å› ä¸ºä»<code>chan</code>ä¸­å–æ•°æ®è¢«é˜»å¡å’Œå› ä¸ºå°†æ•°æ®æ”¾å…¥åˆ°<code>chan</code>ä¸­è¢«é˜»å¡ï¼Œä¸¤ç§æƒ…å†µå”¤é†’æ—¶å¤„ç†æ–¹å¼ä¸ä¸€æ ·ã€‚<code>chan</code>ä¸­å–æ•°æ®è¢«é˜»å¡ï¼Œå”¤é†’çš„æ—¶å€™ä¼šç›´æ¥ä»å‘é€æ•°æ®çš„é‚£ä¸ªgoroutineä¸­å°†æ•°æ®å¤åˆ¶åˆ°å½“å‰è¢«å”¤é†’çš„goroutineä¸­ã€‚ä¸ä¼šå†ç»è¿‡<code>chan</code>ã€‚å‡å°‘äº†å†…å­˜å¤åˆ¶çš„å¼€é”€ã€‚</p>
<h4 id="34-è¯»å†™é”åº•å±‚å®ç°">34. è¯»å†™é”åº•å±‚å®ç°</h4>
<p>è¯»å†™é”ä¸»è¦æ˜¯è¯»ä¸è¯»ä¹‹é—´ä¸äº’æ–¥ï¼Œè¯»å†™ä¸å†™å†™ä¹‹é—´æ˜¯äº’æ–¥çš„ã€‚è¦äº†è§£åº•å±‚å®ç°ï¼Œé¦–å…ˆæˆ‘ä»¬è¦äº†è§£è¯»å†™é”åº•å±‚ç»“æ„ä½“ä»¥åŠç›¸å…³åŠ é”é‡Šæ”¾é”å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">RWMutex</span> <span class="kd">struct</span> <span class="p">{</span>	<span class="nx">w</span>           <span class="nx">Mutex</span>  <span class="c1">// held if there are pending writers	writerSem   uint32 // semaphore for writers to wait for completing readers	readerSem   uint32 // semaphore for readers to wait for completing writers	readerCount int32  // number of pending readers	readerWait  int32  // number of departing readers}
</span></code></pre></td></tr></table>
</div>
</div><p>æ•´ä¸ªè¯»å†™é”å¹¶å‘æ§åˆ¶è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ol>
<li>å¦‚æœæ²¡æœ‰å†™æ“ä½œè¿›å…¥ï¼Œåˆ™æ¯ä¸ªè¯»æ“ä½œéƒ½ä¼šä½¿å¾—readerCountåŠ 1ï¼Œå®ŒæˆåreaderCountå‡1.æ•´ä¸ªè¿‡ç¨‹æ˜¯ä¸ä¼šé˜»å¡çš„ï¼Œå› ä¸ºè¯»ä¸è¯»ä¹‹é—´ä¸äº’æ–¥ã€‚</li>
<li>å½“ç”±å†™æ“ä½œè¿›å…¥çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè¿›è¡Œäº’æ–¥é”é˜»å¡å…¶ä»–å†™æ“ä½œï¼Œå¹¶å°†readerCountä¿®æ”¹ä¸ºå¾ˆå°çš„å€¼ï¼Œä»è€Œé˜»å¡æ–°æ¥çš„è¯»æ“ä½œã€‚</li>
<li>å¦‚æœå†™æ“ä½œè¿›å…¥çš„é¢æ—¶å€™è¿˜æœ‰æ²¡æœ‰å®Œæˆçš„è¯»æ“ä½œï¼Œåˆ™ä¼šè®°å½•è¿™äº›å†™æ“ä½œçš„æ•°é‡ï¼Œç­‰å¾…ä»–ä»¬å…¨éƒ¨å®Œæˆçš„æ—¶å€™ï¼Œå†å°†å†™æ“ä½œå”¤é†’ã€‚æ³¨æ„è¿™ä¸ªæ—¶å€™å·²ç»ä¸ä¼šç”±è¯»æ“ä½œåœ¨è¿›å…¥ã€‚</li>
<li>å†™æ“ä½œå®Œæˆä¹‹åéœ€è¦å°†readerCountç½®ä¸ºåŸæ¥çš„å€¼ï¼Œä¿è¯æ–°çš„è¯»æ“ä½œä¸ä¼šè¢«é˜»å¡ï¼Œç„¶åå”¤é†’ä¹‹å‰ç­‰å¾…çš„è¯»æ“ä½œï¼Œå†å°†äº’æ–¥é”é‡Šæ”¾ã€‚ä½¿å¾—åç»­å†™æ“ä½œä¸ä¼šè¢«é˜»å¡ã€‚</li>
</ol>
<h4 id="35-golangä¸­çš„cspæ€æƒ³">35. golangä¸­çš„CSPæ€æƒ³</h4>
<p>ä¼ ç»Ÿçš„CSPæ¨¡å‹æ˜¯ç”¨äºæè¿°ä¸¤ä¸ªç‹¬ç«‹çš„å¹¶å‘å®ä½“é€šè¿‡å…±äº«çš„ç®¡é“è¿›è¡Œé€šä¿¡çš„å¹¶å‘æ¨¡å‹ï¼Œä¸å…³æ³¨å‘é€æ¶ˆæ¯çš„å®ä½“è€Œå…³æ³¨ä¸å‘é€æ¶ˆæ¯æ—¶ä½¿ç”¨çš„channelã€‚golangå€Ÿç”¨äº†processå’Œchannelçš„æ¦‚å¿µï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®Œå…¨å®ç°CSPæ¨¡å‹çš„æ‰€æœ‰ç†è®ºã€‚processå†goè¯­è¨€ä¸Šè¡¨ç°å°±æ˜¯goroutine æ˜¯å®é™…å¹¶å‘æ‰§è¡Œçš„å®ä½“ï¼Œæ¯ä¸ªå®ä½“ä¹‹é—´æ˜¯é€šè¿‡channelé€šè®¯æ¥å®ç°æ•°æ®å…±äº«ã€‚</p>
<h4 id="36-uintptrå’Œunsafepointerçš„åŒºåˆ«">36. uintptrå’Œunsafe.Pointerçš„åŒºåˆ«ï¼Ÿ</h4>
<ul>
<li>unsafe.Pointeråªæ˜¯å•çº¯çš„é€šç”¨æŒ‡é’ˆç±»å‹ï¼Œç”¨äºè½¬æ¢ä¸åŒç±»å‹æŒ‡é’ˆï¼Œå®ƒä¸å¯ä»¥å‚ä¸æŒ‡é’ˆè¿ç®—ï¼›</li>
<li>è€Œuintptræ˜¯ç”¨äºæŒ‡é’ˆè¿ç®—çš„ï¼ŒGC ä¸æŠŠ uintptr å½“æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¯´ uintptr æ— æ³•æŒæœ‰å¯¹è±¡ï¼Œ uintptr ç±»å‹çš„ç›®æ ‡ä¼šè¢«å›æ”¶ï¼›</li>
<li>unsafe.Pointer å¯ä»¥å’Œ æ™®é€šæŒ‡é’ˆ è¿›è¡Œç›¸äº’è½¬æ¢ï¼›</li>
<li>unsafe.Pointer å¯ä»¥å’Œ uintptr è¿›è¡Œç›¸äº’è½¬æ¢ã€‚</li>
</ul>
<h4 id="37-golangåƒåœ¾å›æ”¶">37. golangåƒåœ¾å›æ”¶</h4>
<p>â€‹	åƒåœ¾å›æ”¶çš„æ¦‚å¿µä¸»è¦æ˜¯ä¸ºäº†å›æ”¶å †ä¸Šçš„å†…å­˜ç©ºé—´ï¼Œå¯¹äºé‚£äº›æ²¡æœ‰ä»»ä½•å˜é‡å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œå›æ”¶ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶åšçš„æœ€å¥½çš„è¿˜æ˜¯è¦çœ‹<code>java</code>çš„åƒåœ¾å›æ”¶æœºåˆ¶ã€‚åƒåœ¾å›æ”¶æ€»ä½“ä¸Šåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæ­¥éª¤æ˜¯åˆ¤æ–­å“ªäº›å†…å­˜ç©ºé—´æ˜¯éœ€è¦è¢«å›æ”¶çš„ï¼Œç¬¬äºŒæ­¥æ˜¯é€‰æ‹©åˆé€‚çš„å›æ”¶ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚<code>c,c++,Rust</code>ç­‰éƒ½æ˜¯å†æ ˆä¸Šåˆ›å»ºçš„å˜é‡ä½œç”¨åŸŸç»“æŸåè‡ªåŠ¨å›æ”¶ï¼Œä½†æ˜¯é€šè¿‡<code>malloc</code>åœ¨å †ä¸Šç”³è¯·çš„éœ€è¦ä½¿ç”¨<code>free</code>æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ã€‚è€Œ<code>python,java,go</code>åˆ™æ˜¯è‡ªåŠ¨è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå‘¨æœŸæ€§é‡Šæ”¾å·²ç»æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>â€‹	åƒåœ¾å›æ”¶å™¨çš„ç›®æ ‡ï¼š</p>
<ol>
<li>é˜²æ­¢å†…å­˜æ³„éœ²ï¼Œæœ€åŸºæœ¬çš„ç›®æ ‡å°±æ˜¯é˜²æ­¢æœªåŠæ—¶æ”¶é›†è€Œé€ æˆå†…å­˜æ³„éœ²ã€‚</li>
<li>è‡ªåŠ¨å›æ”¶æ²¡æœ‰ç”¨çš„å†…å­˜ã€‚</li>
<li>å‡å°‘å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿï¼Œé‡æ•´å†…å­˜ç©ºé—´ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚</li>
</ol>
<p>ç¬¬ä¸€æ­¥åˆ¤æ–­å“ªäº›å¯¹è±¡å¯ä»¥å›æ”¶çš„ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>å¼•ç”¨è®¡æ•°æ³•ï¼Œå¼•ç”¨è®¡æ•°å®ç°ç®€å•ï¼Œå¹¶ä¸”å›æ”¶å¿«é€Ÿï¼Œä¸éœ€è¦æš‚åœã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</li>
<li>å¯è¾¾æ€§åˆ†æç®—æ³•ã€‚è¿™ä¹Ÿæ˜¯å¤§å¤šæ•°å›æ”¶ç®—æ³•æ‰€ç”¨çš„åˆ¤æ–­æ˜¯å¦å¯ä»¥å›æ”¶çš„ç®—æ³•ã€‚å¯è¾¾æ€§åˆ†æç®—æ³•éœ€è¦ä¸€ä¸ª<code>GC Root</code>,ä¸€èˆ¬æƒ…å†µä¸‹<code>GC Root</code>é€‰æ‹©å¯¹è±¡æ˜¯å…¨å±€å¯¹è±¡ï¼Œæ ˆä¸Šçš„å¯¹è±¡ï¼ˆå‡½æ•°å‚æ•°ä¸å†…éƒ¨å˜é‡ã€‚ï¼‰ã€‚ä½†æ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•éœ€è¦æš‚åœæ•´ä¸ªç¨‹åºï¼Œå³<code>Stop the World STW</code>ã€‚å› ä¸ºå¦‚æœä¸æš‚åœç¨‹åºï¼Œå¯èƒ½ä¼šé€ æˆæ ‡è®°çš„è¿‡ç¨‹ä¸­ä¼šå‡ºç°é”™è¯¯ï¼Œæœ‰å¯èƒ½æœ‰çš„å¯¹è±¡é‡æ–°è¢«ä½¿ç”¨ï¼Œä½†æ˜¯å´åœ¨ä¹‹å‰è¢«æ ‡è®°ä¸ºå›æ”¶ã€‚</li>
</ol>
<p>ç¬¬äºŒæ­¥å›æ”¶ç®—æ³•ï¼š</p>
<ol>
<li>æ ‡è®°æ¸…é™¤ é€ æˆå†…å­˜ç¢ç‰‡è¾ƒå¤š</li>
<li>æ ‡è®°æ•´ç† æ•´ç†å†…å­˜ç¢ç‰‡æ—¶é—´è¾ƒé•¿</li>
<li>æ ‡è®°å¤åˆ¶ å†…å­˜åªèƒ½ç”¨ä¸€åŠ</li>
</ol>
<p>golangçš„åƒåœ¾å›æ”¶ç®—æ³•åˆ™æ˜¯ä¸‰è‰²æ ‡è®°æ³•ï¼Œåœ¨ä¸æš‚åœç¨‹åºçš„æƒ…å†µä¸‹ï¼Œå®Œæˆå¯¹è±¡çš„å¯è¾¾æ€§åˆ†æã€‚å…¶ä¼šå°†å…¨éƒ¨å¯¹è±¡åˆ†ä¸ºä¸‰ç±»:</p>
<ul>
<li>ç™½è‰²ï¼šæœªæœç´¢çš„å¯¹è±¡ï¼Œåœ¨å›æ”¶å‘¨æœŸå¼€å§‹æ—¶æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²ï¼Œåœ¨å›æ”¶å‘¨æœŸç»“æŸæ—¶æ‰€æœ‰çš„ç™½è‰²éƒ½æ˜¯åƒåœ¾å¯¹è±¡</li>
<li>ç°è‰²ï¼šæ­£åœ¨æœç´¢çš„å¯¹è±¡ï¼Œä½†æ˜¯å¯¹è±¡èº«ä¸Šè¿˜æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå¼•ç”¨æ²¡æœ‰æ‰«æ</li>
<li>é»‘è‰²ï¼šå·²æœç´¢å®Œçš„å¯¹è±¡ï¼Œæ‰€æœ‰çš„å¼•ç”¨å·²ç»è¢«æ‰«æå®Œ</li>
</ul>
<p>å…·ä½“æœç´¢è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>åˆå§‹æ—¶æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²å¯¹è±¡</li>
<li>ä»<code>GC Root</code>å¯¹è±¡å‡ºå‘ï¼Œæ‰«ææ‰€æœ‰å¯è¾¾å¯¹è±¡å¹¶æ ‡è®°ä¸ºç°è‰²ï¼Œæ”¾å…¥å¾…å¤„ç†é˜Ÿåˆ—</li>
<li>ä»é˜Ÿåˆ—å–å‡ºä¸€ä¸ªç°è‰²å¯¹è±¡å¹¶æ ‡è®°ä¸ºé»‘è‰²ï¼Œå°†å…¶å¼•ç”¨å¯¹è±¡æ ‡è®°ä¸ºç°è‰²æ”¾å…¥é˜Ÿåˆ—</li>
<li>é‡å¤ä¸Šä¸€æ­¥éª¤ï¼Œç›´åˆ°ç°è‰²å¯¹è±¡é˜Ÿåˆ—ä¸ºç©º</li>
<li>æ­¤æ—¶æ‰€æœ‰å‰©ä¸‹çš„ç™½è‰²å¯¹è±¡å°±æ˜¯åƒåœ¾å¯¹è±¡</li>
</ul>
<p>å…¶ä¼˜ç‚¹å°±æ˜¯ä¸ç”¨æš‚åœç¨‹åºå°±å¯ä»¥è¿›è¡Œå›æ”¶ã€‚ä½†æ˜¯åœ¨ç¨‹åºåƒåœ¾å¯¹è±¡çš„äº§ç”Ÿé€Ÿåº¦å¤§äºåƒåœ¾å¯¹è±¡çš„å›æ”¶é€Ÿåº¦æ—¶ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºä¸­çš„åƒåœ¾å¯¹è±¡è¶Šæ¥è¶Šå¤šè€Œæ— æ³•åŠæ—¶æ”¶é›†ã€‚</p>
<h4 id="38-å†™å±éšœæ··åˆå†™å±éšœ">38. å†™å±éšœï¼Œæ··åˆå†™å±éšœ</h4>
<p>â€‹	è¿™ä¸¤ä¸ªä¸»è¦æ˜¯ä¸ºäº†ä¸‰è‰²æ ‡è®°æ³•å’Œç”¨æˆ·ç¨‹åºå¹¶å‘è¿‡ç¨‹å‡ºç°çš„é—®é¢˜è€Œå‡ºç°çš„ã€‚å½“ä¸‰è‰²æ ‡è®°æ”¶é›†è¿‡ç¨‹ä¸­æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶å°±å¯èƒ½å‡ºç°é”™è¯¯å›æ”¶éåƒåœ¾å¯¹è±¡çš„é—®é¢˜ã€‚</p>
<ul>
<li>æ¡ä»¶1ï¼šæŸä¸€é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡</li>
<li>æ¡ä»¶2ï¼šå¯¹äºæŸä¸ªç™½è‰²å¯¹è±¡ï¼Œæ‰€æœ‰å’Œå®ƒå­˜åœ¨å¯è¾¾å…³ç³»çš„ç°è‰²å¯¹è±¡ä¸¢å¤±äº†è®¿é—®å®ƒçš„å¯è¾¾è·¯å¾„</li>
</ul>
<p>å¸¸è§è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>STW</code>ï¼Œä½†æ˜¯è¿™ä¸ªè¿èƒŒäº†ä¸‰è‰²æ ‡è®°è®¾è®¡çš„ç›®çš„ï¼Œè€Œå¦å¤–ä¸€ç§å°±æ˜¯è¯»å†™å±éšœæŠ€æœ¯ã€‚</p>
<p>ä½¿ç”¨å±éšœæŠ€æœ¯å¯ä»¥ä½¿å¾—ç”¨æˆ·ç¨‹åºå’Œä¸‰è‰²æ ‡è®°è¿‡ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæˆ‘ä»¬åªéœ€è¦è¾¾æˆä¸‹åˆ—ä»»æ„ä¸€ç§ä¸‰è‰²ä¸å˜æ€§ï¼š</p>
<ul>
<li>å¼ºä¸‰è‰²ä¸å˜æ€§ï¼šé»‘è‰²å¯¹è±¡æ°¸è¿œä¸ä¼šæŒ‡å‘ç™½è‰²å¯¹è±¡</li>
<li>å¼±ä¸‰è‰²ä¸å˜æ€§ï¼šé»‘è‰²å¯¹è±¡æŒ‡å‘çš„ç™½è‰²å¯¹è±¡è‡³å°‘åŒ…å«ä¸€æ¡ç”±ç°è‰²å¯¹è±¡ç»è¿‡ç™½è‰²å¯¹è±¡çš„å¯è¾¾è·¯å¾„</li>
</ul>
<p><code>GC</code>ä¸­ä½¿ç”¨çš„å†…å­˜è¯»å†™å±éšœæŠ€æœ¯æŒ‡çš„æ˜¯ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´ç”Ÿæˆä¸€æ®µä»£ç ï¼Œè¯¥ä»£ç åœ¨è¿è¡ŒæœŸé—´ç”¨æˆ·è¯»å–ã€åˆ›å»ºæˆ–æ›´æ–°å¯¹è±¡æŒ‡é’ˆæ—¶ä¼šæ‹¦æˆªå†…å­˜è¯»å†™æ“ä½œï¼Œç›¸å½“äºä¸€ä¸ª<code>hook</code>è°ƒç”¨ï¼Œæ ¹æ®<code>hook</code>æ—¶æœºä¸åŒå¯åˆ†ä¸ºä¸åŒçš„å±éšœæŠ€æœ¯ã€‚ç”±äºè¯»å±éšœ<code>Read barrier</code>æŠ€æœ¯éœ€è¦åœ¨è¯»æ“ä½œä¸­æ’å…¥ä»£ç ç‰‡æ®µä»è€Œå½±å“ç”¨æˆ·ç¨‹åºæ€§èƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨å†™å±éšœæŠ€æœ¯æ¥ä¿è¯ä¸‰è‰²æ ‡è®°çš„ç¨³å¥æ€§ã€‚</p>
<h4 id="39-var-_-iowriter--mywriternilè¿™æ ·å†™çš„ç›®çš„æ˜¯ä¸ºäº†ä»€ä¹ˆ">39. <code>var _ io.Writer = (*myWriter)(nil)</code>è¿™æ ·å†™çš„ç›®çš„æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿ</h4>
<p>ä¸»è¦æ˜¯ä¸ºæ£€æŸ¥æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ã€‚ä¾‹å¦‚é¢˜ç›®ä¸­çš„æ„æ€å°±æ˜¯ä¸ºäº†çœ‹<code>myWriter</code>æ˜¯å¦å®ç°äº†<code>io.Writer</code>æ¥å£ã€‚</p>
<h4 id="40--gmpæ¨¡å‹">40.  GMPæ¨¡å‹</h4>
<p>â€‹	GMPæ¨¡å‹golangçš„å¹¶å‘è°ƒåº¦æ¨¡å‹ã€‚å…¶ä¸­Gè¡¨ç¤ºGoroutineï¼ŒMè¡¨ç¤ºå†…æ ¸çº¿ç¨‹ï¼ŒPè¡¨ç¤ºè°ƒåº¦å™¨ã€‚GMPæ¨¡å‹çš„ç»„æˆå°±æ˜¯ç”±å…¨å±€åç¨‹é˜Ÿåˆ—ï¼Œæ¯ä¸ªPæ‰€å…·æœ‰çš„æœ¬åœ°åç¨‹é˜Ÿåˆ—ã€‚å½“å‰Pæœ¬åœ°åç¨‹é˜Ÿåˆ—ä¸­æ²¡æœ‰Gï¼Œåˆ™ä¼šå–å…¨å±€åç¨‹é˜Ÿåˆ—ä¸­å–ã€‚è€Œå¦‚æœå…¨å±€é˜Ÿåˆ—ä¸­ä¹Ÿæ²¡æœ‰ï¼Œå°±ä¼šä»å…¶ä»–çš„Pçš„æœ¬åœ°åç¨‹é˜Ÿåˆ—ä¸­å·å–ã€‚</p>
<h4 id="41-å¿…é¡»è¦æ‰‹åŠ¨å†…å­˜å¯¹é½çš„æƒ…å†µ">41. å¿…é¡»è¦æ‰‹åŠ¨å†…å­˜å¯¹é½çš„æƒ…å†µ</h4>
<p>æ‰‹åŠ¨å†…å­˜å¯¹é½ä¸»è¦æ˜¯ä¸ºäº†å¹³å°çš„ç§»æ¤ã€‚ä¾‹å¦‚<code>struct</code>ä¸­å­—æ®µé¡ºåºä¸åŒï¼Œå†…å­˜å ç”¨ä¹Ÿä¼šä¸åŒã€‚ä¸»è¦æ˜¯å› ä¸ºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šä½¿ç”¨å†…å­˜å¯¹é½ï¼Œæ‰€ä»¥åœ¨å†…å­˜ä¸­åˆ†å¸ƒä¼šæœ‰é«˜ä½åœ°ä½çš„åŒºåˆ«ã€‚ä¹Ÿå°±æ˜¯ä¸åŒçš„é¡ºåºä¼šé€ æˆå†…å­˜éƒ¨åˆ†å†…å­˜æ— æ³•ä½¿ç”¨ã€‚è€Œä¸”åŠ å…¥ç¨‹åºè¿è¡Œåœ¨ä¸åŒå¯¹é½æ–¹å¼çš„å¹³å°ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´<code>panic</code>ã€‚</p>
<h4 id="42-go-æ ˆæ‰©å®¹å’Œæ ˆç¼©å®¹ä»¥åŠè¿ç»­æ ˆçš„ç¼ºç‚¹">42. go æ ˆæ‰©å®¹å’Œæ ˆç¼©å®¹ï¼Œä»¥åŠè¿ç»­æ ˆçš„ç¼ºç‚¹</h4>
<p>goçš„æ ˆæ›´æ–°è¿‡åï¼Œä»åˆ†æ®µæ ˆè½¬æ¢ä¸ºè¿ç»­æ ˆã€‚è¿ç»­æ ˆçš„å®ç°æ–¹å¼ï¼šå½“æ£€æµ‹åˆ°éœ€è¦è€•è¯»å“¦çš„æ ˆçš„æ—¶å€™ï¼Œåˆ†é…æ¯”åŸæ¥å¤§ä¸€å€çš„æ ˆï¼ŒæŠŠæ—§æ•°æ®æ‹·è´åˆ°æ–°æ ˆï¼Œé‡Šæ”¾æ—§æ ˆã€‚</p>
<ul>
<li>æ ˆæ‰©å®¹ä¼šå°†æ ˆæ‰©å……åˆ°æ¯”å‰é¢ä¸¤å€ã€‚</li>
<li>æ ˆç¼©å®¹å‘ç”Ÿåœ¨GCæœŸé—´ï¼Œç¼©å®¹å°±æ˜¯ç”¨åˆ†é…ä¸€å—æ–°çš„å†…å­˜æ¥æ›¿æ¢åŸæ¥çš„ï¼Œå¤§å°ä¹Ÿæ˜¯ç¼©å°ä¸€å€ã€‚</li>
</ul>
<p>è¿ç»­æ ˆè™½ç„¶è§£å†³äº†åˆ†æ®µæ ˆçš„2ä¸ªé—®é¢˜ï¼Œä½†è¿™ç§å®ç°æ–¹å¼ä¹Ÿä¼šå¸¦æ¥å…¶ä»–é—®é¢˜ï¼š</p>
<ul>
<li>æ›´å¤šçš„è™šæ‹Ÿå†…å­˜ç¢ç‰‡ã€‚å°¤å…¶æ˜¯ä½ éœ€è¦æ›´å¤§çš„æ ˆæ—¶ï¼Œåˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ä¼šå˜å¾—æ›´å›°éš¾</li>
<li>æŒ‡é’ˆä¼šè¢«é™åˆ¶æ”¾å…¥æ ˆã€‚åœ¨goé‡Œé¢ä¸å…è®¸äºŒä¸ªåç¨‹çš„æŒ‡é’ˆç›¸äº’æŒ‡å‘ã€‚è¿™ä¼šå¢åŠ å®ç°çš„å¤æ‚æ€§ã€‚</li>
</ul>
<h4 id="43-golang-é—­åŒ…">43. golang é—­åŒ…</h4>
<p><strong>é—­åŒ…</strong> æ˜¯ç”±å‡½æ•°åŠå…¶ç›¸å…³å¼•ç”¨ç¯å¢ƒç»„åˆè€Œæˆçš„å®ä½“(å³ï¼šé—­åŒ…=å‡½æ•°+å¼•ç”¨ç¯å¢ƒ)ã€‚ä»ä¸‹é¢çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ<code>a,b</code>çš„å€¼ä¼šæ ¹æ®è°ƒç”¨é—­åŒ…å‡½æ•°çš„æ¬¡æ•°é€æ¸æ›´æ–°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">fib</span><span class="p">()</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>	<span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>	<span class="k">return</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>		<span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="p">=</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="o">+</span><span class="nx">b</span>		<span class="k">return</span> <span class="nx">a</span>	<span class="p">}}</span><span class="c1">// è°ƒç”¨å¦‚ä¸‹f00 := fib()fmt.Println(f00(), f00(), f00(), f00(), f00())// è¾“å‡ºç»“æœæ˜¯ï¼š1 1 2 3 5
</span></code></pre></td></tr></table>
</div>
</div><p>é—­åŒ…å‡½æ•°ä¸»è¦æœ‰ä¸¤ç§åœºæ™¯ã€‚</p>
<ol>
<li>é—­åŒ…é‡Œæ²¡æœ‰å¼•ç”¨ç¯å¢ƒ&amp;è·å–å¼•ç”¨å…¨å±€å˜é‡ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œå…¶å®ç°å°±æ˜¯æ™®é€šçš„å‡½æ•°ï¼ŒæŒ‰ç…§æ™®é€šçš„å‡½æ•°è°ƒç”¨æ–¹å¼æ‰§è¡Œé—­åŒ…è°ƒç”¨ã€‚</li>
<li>é—­åŒ…é‡Œå¼•ç”¨å±€éƒ¨å˜é‡ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œæ‰æ˜¯çœŸæ­£çš„é—­åŒ…ï¼ˆå‡½æ•°+å¼•ç”¨ç¯å¢ƒï¼‰ï¼Œå¹¶ä¸”ä»¥ä¸€ä¸ªstruct{FuncAddr, LocalAddr3, LocalAddr2, LocalAddr1}ç»“æ„å­˜å‚¨è¯¥é—­åŒ…ï¼Œç­‰åˆ°è°ƒç”¨é—­åŒ…æ—¶ï¼Œä¼šæŠŠè¯¥ç»“æ„åœ°å€æå‰æ”¾ç½®ä¸€ä¸ªå¯„å­˜å™¨ï¼Œé—­åŒ…å†…éƒ¨é€šè¿‡è¯¥å¯„å­˜å™¨è®¿é—®å¼•ç”¨ç¯å¢ƒçš„å˜é‡ã€‚ä¹Ÿå°±æ˜¯ä¸Šè¿°ä¾‹å­çš„æƒ…å†µã€‚<code>a,b</code>è¢«å­˜å‚¨ã€‚</li>
</ol>
<h4 id="44--goroutineä»€ä¹ˆæ—¶å€™ä¼šè¢«æŒ‚èµ·">44.  Goroutineä»€ä¹ˆæ—¶å€™ä¼šè¢«æŒ‚èµ·ï¼Ÿ</h4>
<p>goroutineæŒ‚èµ·çš„åŸå› æœ‰å¾ˆå¤šï¼Œè¿™ä¸ªåœ¨goæºç ä¸­ç”±è¯¦ç»†çš„å™è¿°ï¼Œå¹¶ä¸”å°†æ‰€æœ‰çš„åŸå› åˆ—äº†å‡ºæ¥ã€‚å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// package runtime\runtime2var waitReasonStrings = [...]string{	waitReasonZero:                  &#34;&#34;,	waitReasonGCAssistMarking:       &#34;GC assist marking&#34;, // GCè¾…åŠ©æ ‡è®°é˜¶æ®µ	waitReasonIOWait:                &#34;IO wait&#34;, // IOé˜»å¡ç­‰å¾…	waitReasonChanReceiveNilChan:    &#34;chan receive (nil chan)&#34;, // å¯¹æœªåˆå§‹åŒ–çš„chanè¿›è¡Œè¯»æ“ä½œ	waitReasonChanSendNilChan:       &#34;chan send (nil chan)&#34;, // å¯¹æœªåˆå§‹åŒ–çš„chanè¿›è¡Œå†™æ“ä½œ	waitReasonDumpingHeap:           &#34;dumping heap&#34;, // å¯¹ Go Heap å † dump æ—¶ä¸ªçš„ä½¿ç”¨åœºæ™¯ä»…åœ¨ runtime.debug æ—¶ï¼Œä¹Ÿå°±æ˜¯å¸¸è§çš„ pprof è¿™ä¸€ç±»é‡‡é›†æ—¶é˜»å¡ã€‚	waitReasonGarbageCollection:     &#34;garbage collection&#34;, // åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œä¸»è¦åœºæ™¯æ˜¯ GC æ ‡è®°ç»ˆæ­¢(GC Mark Termination)é˜¶æ®µæ—¶è§¦å‘ã€‚	waitReasonGarbageCollectionScan: &#34;garbage collection scan&#34;, // åœ¨åƒåœ¾å›æ”¶æ‰«ææ—¶ï¼Œä¸»è¦åœºæ™¯æ˜¯ GC æ ‡è®°(GC Mark)æ‰«æ Root é˜¶æ®µæ—¶è§¦å‘ã€‚	waitReasonPanicWait:             &#34;panicwait&#34;, // åœ¨ main goroutine å‘ç”Ÿ panic æ—¶ï¼Œä¼šè§¦å‘ã€‚	waitReasonSelect:                &#34;select&#34;, // å…³é”®å­— select	waitReasonSelectNoCases:         &#34;select (no cases)&#34;, //åœ¨è°ƒç”¨å…³é”®å­— select æ—¶ï¼Œè‹¥ä¸€ä¸ª case éƒ½æ²¡æœ‰ï¼Œä¼šç›´æ¥è§¦å‘ã€‚	waitReasonGCAssistWait:          &#34;GC assist wait&#34;, // GC è¾…åŠ©æ ‡è®°é˜¶æ®µä¸­çš„ç»“æŸè¡Œä¸ºï¼Œä¼šè§¦å‘ã€‚	waitReasonGCSweepWait:           &#34;GC sweep wait&#34;, // GC æ¸…æ‰«é˜¶æ®µä¸­çš„ç»“æŸè¡Œä¸ºï¼Œä¼šè§¦å‘ã€‚	waitReasonGCScavengeWait:        &#34;GC scavenge wait&#34;, //GC scavenge é˜¶æ®µçš„ç»“æŸè¡Œä¸ºï¼Œä¼šè§¦å‘ã€‚GC Scavenge ä¸»è¦æ˜¯æ–°ç©ºé—´çš„åƒåœ¾å›æ”¶ï¼Œæ˜¯ä¸€ç§ç»å¸¸è¿è¡Œã€å¿«é€Ÿçš„ GCï¼Œè´Ÿè´£ä»æ–°ç©ºé—´ä¸­æ¸…ç†è¾ƒå°çš„å¯¹è±¡ã€‚	waitReasonChanReceive:           &#34;chan receive&#34;, //åœ¨ channel è¿›è¡Œè¯»æ“ä½œï¼Œä¼šè§¦å‘ã€‚	waitReasonChanSend:              &#34;chan send&#34;, // åœ¨ channel è¿›è¡Œå†™æ“ä½œï¼Œä¼šè§¦å‘ã€‚	waitReasonFinalizerWait:         &#34;finalizer wait&#34;, //åœ¨ finalizer ç»“æŸçš„é˜¶æ®µï¼Œä¼šè§¦å‘ã€‚åœ¨ Go ç¨‹åºä¸­ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ runtime.SetFinalizer å‡½æ•°æ¥ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®ä¸€ä¸ªç»ˆç»“è€…å‡½æ•°ã€‚è¿™ä¸ªè¡Œä¸ºå¯¹åº”ç€ç»“æŸé˜¶æ®µé€ æˆçš„å›æ”¶ã€‚ 	waitReasonForceGCIdle:           &#34;force gc (idle)&#34;, // å¼ºåˆ¶ GC(ç©ºé—²æ—¶é—´)ç»“æŸæ—¶ï¼Œä¼šè§¦å‘ã€‚	waitReasonSemacquire:            &#34;semacquire&#34;, // ä¿¡å·é‡å¤„ç†ç»“æŸæ—¶ï¼Œä¼šè§¦å‘ã€‚	waitReasonSleep:                 &#34;sleep&#34;, // ç»å…¸çš„ sleep è¡Œä¸ºï¼Œä¼šè§¦å‘ã€‚ 	waitReasonSyncCondWait:          &#34;sync.Cond.Wait&#34;, // ç»“åˆ sync.Cond ç”¨æ³•èƒ½çŸ¥é“ï¼Œæ˜¯åœ¨è°ƒç”¨ sync.Wait æ–¹æ³•æ—¶æ‰€è§¦å‘ã€‚	waitReasonTimerGoroutineIdle:    &#34;timer goroutine (idle)&#34;, // ä¸ Timer ç›¸å…³ï¼Œåœ¨æ²¡æœ‰å®šæ—¶å™¨éœ€è¦æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¼šè§¦å‘ã€‚	waitReasonTraceReaderBlocked:    &#34;trace reader (blocked)&#34;, // ä¸ Trace ç›¸å…³ï¼ŒReadTraceä¼šè¿”å›äºŒè¿›åˆ¶è·Ÿè¸ªæ•°æ®ï¼Œå°†ä¼šé˜»å¡ç›´åˆ°æ•°æ®å¯ç”¨ã€‚ 	waitReasonWaitForGCCycle:        &#34;wait for GC cycle&#34;, // ç­‰å¾… GC å‘¨æœŸï¼Œä¼šä¼‘çœ é€ æˆé˜»å¡ã€‚	waitReasonGCWorkerIdle:          &#34;GC worker (idle)&#34;, // GC Worker ç©ºé—²æ—¶ï¼Œä¼šä¼‘çœ é€ æˆé˜»å¡ã€‚	waitReasonPreempted:             &#34;preempted&#34;, // å‘ç”Ÿå¾ªç¯è°ƒç”¨æŠ¢å æ—¶ï¼Œä¼šä¼šä¼‘çœ ç­‰å¾…è°ƒåº¦ã€‚	waitReasonDebugCall:             &#34;debug call&#34;, // è°ƒç”¨ GODEBUG æ—¶ï¼Œä¼šè§¦å‘ã€‚}
</span></code></pre></td></tr></table>
</div>
</div><p>ç»¼ä¸Šæ‰€è¿°ä¸»è¦çš„åœºæ™¯æ˜¯ï¼š</p>
<ul>
<li>é€šé“(Channel)ã€‚</li>
<li>åƒåœ¾å›æ”¶(GC)ã€‚</li>
<li>ä¼‘çœ (Sleep)ã€‚</li>
<li>é”ç­‰å¾…(Lock)ã€‚</li>
<li>æŠ¢å (Preempted)ã€‚</li>
<li>IO é˜»å¡(IO Wait)</li>
<li>å…¶ä»–ï¼Œä¾‹å¦‚ï¼španicã€finalizerã€select ç­‰ã€‚</li>
</ul>
<h4 id="45-data-traceæ˜¯ä»€ä¹ˆæ€ä¹ˆæ£€æµ‹ä»¥åŠè§£å†³">45. DATA Traceæ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆæ£€æµ‹ä»¥åŠè§£å†³ï¼Ÿ</h4>
<p>Data Traceå°±æ˜¯å¹¶å‘è¿‡ç¨‹ä¸­çš„æ•°æ®ç«äº‰é—®é¢˜ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>-trace</code>æ·»åŠ åˆ°ç¼–è¯‘å‘½ä»¤è¡Œæ¥æ£€æµ‹data traceæƒ…å†µã€‚</p>
<p>è§£å†³è¿™ç§æƒ…å†µå°±æ˜¯è§£å†³å¹¶å‘åŒæ­¥é—®é¢˜ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>sync.WaitGroup,æ— ç¼“å†²é€šé“ï¼Œmutexé”</code>ã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p>[1].<a href="https://zhuanlan.zhihu.com/p/356739568">Go å¹¶å‘ä¹‹ä¸‰ç§çº¿ç¨‹å®‰å…¨çš„ map - çŸ¥ä¹ (zhihu.com)</a></p>
<p>[2]. <a href="https://juejin.cn/post/6881912621616857102">Golang ä¹‹ structèƒ½ä¸èƒ½æ¯”è¾ƒ - æ˜é‡‘ (juejin.cn)</a></p>
<p>[3].<a href="https://www.bwangel.me/2019/05/21/review-json-and-go/">Review ã€ŠJSON and Goã€‹ - å¤§ç™½çš„ç¢ç¢å¿µ (bwangel.me)</a></p>
<p>[4].https://learnku.com/docs/the-way-to-go/</p>
<p>[5].<a href="https://segmentfault.com/a/1190000039843497">ç®€å•èŠèŠå†…å­˜é€ƒé€¸ ï½œ å‰‘æŒ‡ offer - golang - SegmentFault æ€å¦</a></p>
<p>[6].<a href="https://zhuanlan.zhihu.com/p/36907022">æ·±å…¥golangä¹‹&mdash;goroutineå¹¶å‘æ§åˆ¶ä¸é€šä¿¡ - çŸ¥ä¹ (zhihu.com)</a></p>
<p>[7].<a href="https://i6448038.github.io/2019/04/11/go-channel/">å›¾è§£Goçš„channelåº•å±‚å®ç° - èœåˆšRyuGouçš„åšå®¢ (i6448038.github.io)</a></p>
<p>[8].<a href="https://segmentfault.com/a/1190000039712353">go è¯»å†™é”å®ç°åŸç†è§£è¯» - SegmentFault æ€å¦</a></p>
<p>[9].<a href="https://zhuanlan.zhihu.com/p/297177002">å›¾ç¤ºGolangåƒåœ¾å›æ”¶æœºåˆ¶ - çŸ¥ä¹ (zhihu.com)</a></p>
<p>[10].<a href="https://cloud.tencent.com/developer/article/1489459">Golang æ˜¯å¦æœ‰å¿…è¦å†…å­˜å¯¹é½ï¼Ÿ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘ (tencent.com)</a></p>
<p>[11].<a href="https://zhuanlan.zhihu.com/p/70256971">ã€é¢è¯•é«˜é¢‘é—®é¢˜ã€‘çº¿ç¨‹ã€è¿›ç¨‹ã€åç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p>

    </div>
</div>

<div class="container">
    
    <nav class="flex container suggested">
        
        <a rel="prev" href="https://hearecho.github.io/post/%E6%8E%92%E5%BA%8F/" title="Previous post (older)">
            <span>Previous</span>
            æ’åº
            </a>
        
        
        
        <a rel="next" href="https://hearecho.github.io/post/go%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/" title="Next post (newer)">
            <span>Next</span>
            Goåƒåœ¾æ”¶é›†
            </a> 
        
    </nav>
    
</div>
</main>


        </main>
        <footer class="footer flex">
    <section class="container">
        <nav class="footer-links">
            
            <a href="https://hearecho.github.io/index.xml">ğŸ“¡</a>
            
        </nav>
    </section>
    <script async src="https://hearecho.github.io/ts/features.aae54872a4ce10f31183401ffe494fdc7160fa4925869741aee7ab580afc9908.js" data-enable-footnotes="true"></script>
</footer>
    </body>
</html>